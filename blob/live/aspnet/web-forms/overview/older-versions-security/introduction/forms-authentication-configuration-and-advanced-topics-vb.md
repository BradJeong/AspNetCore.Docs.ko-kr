---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: "폼 인증 구성 및 고급 항목 (VB) | Microsoft Docs"
author: rick-anderson
description: "이 자습서에서는 다양 한 폼 인증 설정을 검사 하 고 폼 요소를 통해 수정 하는 방법을 참조 합니다. 이것을 통해 설명을 수반 중..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/14/2008
ms.topic: article
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: e92bb3d67141ba0ce594fd17c266bc69dda3cb5a
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/10/2017
---
<a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="d9b06-104">폼 인증 구성 및 고급 항목 (VB)</span><span class="sxs-lookup"><span data-stu-id="d9b06-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>
====================
<span data-ttu-id="d9b06-105">으로 [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d9b06-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d9b06-106">[코드를 다운로드](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) 또는 [PDF 다운로드](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="d9b06-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="d9b06-107">이 자습서에서는 다양 한 폼 인증 설정을 검사 하 고 폼 요소를 통해 수정 하는 방법을 참조 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="d9b06-108">이 작업을 사용자 지정 URL (예: SignIn.aspx Login.aspx 대신)와 cookieless 폼 인증 티켓 로그인 페이지를 사용 하 여 폼 인증 티켓 시간 제한 값을 사용자 지정에 대해 자세히를 수반 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="d9b06-109">소개</span><span class="sxs-lookup"><span data-stu-id="d9b06-109">Introduction</span></span>

<span data-ttu-id="d9b06-110">에 [이전 자습서](an-overview-of-forms-authentication-vb.md) 로그인 페이지를 표시 하려면 다른 만들지를 Web.config에서 구성 설정을 지정 하에서 ASP.NET 응용 프로그램에서 폼 인증을 구현 하는 데 필요한 단계에서 인증 되 고 익명 사용자에 대 한 내용입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="d9b06-111">모드 특성을 설정 하 여 폼 인증을 사용 하도록 웹 사이트를 구성 했습니다 회수는 &lt;인증&gt; 요소 폼에 적용 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="d9b06-112">&lt;인증&gt; 요소 포함 되기도 &lt;forms&gt; 자식 요소에는 다양 한 폼 인증 설정을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="d9b06-113">이 자습서에서는 다양 한 폼 인증 설정을 검사 하 고 사용 하 여 수정 하는 방법을 참조 합니다는 &lt;forms&gt; 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9b06-114">이 작업을 사용자 지정 URL (예: SignIn.aspx Login.aspx 대신)와 cookieless 폼 인증 티켓 로그인 페이지를 사용 하 여 폼 인증 티켓 시간 제한 값을 사용자 지정에 대해 자세히를 수반 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="d9b06-115">또한 폼 인증 티켓의 구성을 더 자세히 검사 하 고 ASP.NET 티켓의 데이터를 검사 하 고 변조에서 안전 하는 데 걸리는 예방 조치를 참조 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="d9b06-116">마지막으로 폼 인증 티켓에 추가 되는 사용자 데이터를 저장 하는 방법과 사용자 지정 보안 주체 개체를 통해이 데이터를 모델링 하는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="d9b06-117">1 단계: 검사 하는 &lt;forms&gt; 구성 설정</span><span class="sxs-lookup"><span data-stu-id="d9b06-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="d9b06-118">Asp.net에서 폼 인증 시스템에서는 다양 한 응용 프로그램에서 응용 프로그램 별로 사용자 지정할 수 있는 구성 설정 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="d9b06-119">여기에 같은 설정이 포함: 수명의 폼 인증 티켓입니다. 어떤 종류의 보호 티켓;에 적용 됩니까 티켓은 어떤 조건 쿠키 인증에서 사용 됩니다. 로그인 페이지;의 경로를 및 기타 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="d9b06-120">기본값을 수정 하려면 추가 [ &lt;forms&gt; 요소](https://msdn.microsoft.com/en-us/library/1d3t3c61.aspx) 의 자식으로는 [ &lt;인증&gt; 요소](https://msdn.microsoft.com/en-us/library/532aee0e.aspx), 해당 속성을 지정 XML 특성으로 사용자 지정 하려면 값 같은 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/en-us/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/en-us/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="d9b06-121">표 1에는 통해 지정할 수 있는 속성이 요약 되어 있습니다.는 &lt;forms&gt; 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9b06-122">Web.config는 XML 파일 이므로 왼쪽된 열에 특성 이름이 대/소문자 구분 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="d9b06-123">**특성**</span><span class="sxs-lookup"><span data-stu-id="d9b06-123">**Attribute**</span></span> | <span data-ttu-id="d9b06-124">**설명**</span><span class="sxs-lookup"><span data-stu-id="d9b06-124">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="d9b06-125">cookieless</span><span class="sxs-lookup"><span data-stu-id="d9b06-125">cookieless</span></span> | <span data-ttu-id="d9b06-126">이 특성 지정 어떤 조건에서 인증 티켓 및 URL에 포함 되는 쿠키에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="d9b06-127">허용 가능한 값은: UseCookies; UseUri; 자동으로 검색 합니다. 및 UseDeviceProfile (기본값)입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="d9b06-128">2 단계는이 설정을 자세히 검사합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-128">Step 2 examines this setting in more detail.</span></span> |
| <span data-ttu-id="d9b06-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="d9b06-129">defaultUrl</span></span> | <span data-ttu-id="d9b06-130">URL 쿼리 문자열에 지정 된 RedirectUrl 값이 없는 경우에 로그인 페이지에서 로그인 한 후 사용자는 리디렉션됩니다을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="d9b06-131">기본값은 default.aspx 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-131">The default value is default.aspx.</span></span> |
| <span data-ttu-id="d9b06-132">도메인</span><span class="sxs-lookup"><span data-stu-id="d9b06-132">domain</span></span> | <span data-ttu-id="d9b06-133">쿠키 기반 인증 티켓을 사용할 경우이 설정은 쿠키의 도메인 값을 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="d9b06-134">기본값은 빈 문자열입니다 (예: www.yourdomain.com) 발급 도메인을 사용 하도록 브라우저.</span><span class="sxs-lookup"><span data-stu-id="d9b06-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="d9b06-135">이 경우 쿠키를 **하지** admin.yourdomain.com 같은 하위 도메인을 요청 하면 보낼 수 있습니다. 모든 하위 도메인에 전달할 쿠키를 원하는 경우, 도메인 속성 설정 yourdomain.com을 사용자 지정 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-135">In this case, the cookie will **not** be sent when making requests to subdomains, such as admin.yourdomain.com. If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
| <span data-ttu-id="d9b06-136">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="d9b06-136">enableCrossAppRedirects</span></span> | <span data-ttu-id="d9b06-137">동일한 서버의 다른 웹 응용 프로그램의 Url로 리디렉션할 때 인증 된 사용자가 저장 하는지 여부를 나타내는 부울 값입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-137">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="d9b06-138">기본값은 false입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-138">The default is false.</span></span> |
| <span data-ttu-id="d9b06-139">로그인 Url</span><span class="sxs-lookup"><span data-stu-id="d9b06-139">loginUrl</span></span> | <span data-ttu-id="d9b06-140">로그인 페이지의 URL입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-140">The URL of the login page.</span></span> <span data-ttu-id="d9b06-141">기본값은 login.aspx입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-141">The default value is login.aspx.</span></span> |
| <span data-ttu-id="d9b06-142">name</span><span class="sxs-lookup"><span data-stu-id="d9b06-142">name</span></span> | <span data-ttu-id="d9b06-143">쿠키의 이름, 쿠키 기반 인증 티켓을 사용할 때</span><span class="sxs-lookup"><span data-stu-id="d9b06-143">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="d9b06-144">기본값은입니다. ASPXAUTH 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-144">The default is .ASPXAUTH.</span></span> |
| <span data-ttu-id="d9b06-145">path</span><span class="sxs-lookup"><span data-stu-id="d9b06-145">path</span></span> | <span data-ttu-id="d9b06-146">쿠키 기반 인증 티켓을 사용할 경우이 설정은의 쿠키 경로 특성을 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-146">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="d9b06-147">Path 특성에는 개발자를 특정 디렉터리 계층 구조를 쿠키의 범위를 제한할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-147">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="d9b06-148">기본값은 / 도메인에 대 한 모든 요청을 인증 티켓 쿠키를 보낼 브라우저에 게 알립니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-148">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span> |
| <span data-ttu-id="d9b06-149">보호</span><span class="sxs-lookup"><span data-stu-id="d9b06-149">protection</span></span> | <span data-ttu-id="d9b06-150">폼 인증 티켓을 보호 하기 위해 어떤 기술을 사용을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-150">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="d9b06-151">허용 가능한 값은: 모두 (기본값); 암호화; 해당 항목이 없습니다. 및 유효성 검사 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-151">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="d9b06-152">이러한 설정에 대해서는 3 단계에서에서 자세히 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-152">These settings are discussed in detail in Step 3.</span></span> |
| <span data-ttu-id="d9b06-153">requireSSL</span><span class="sxs-lookup"><span data-stu-id="d9b06-153">requireSSL</span></span> | <span data-ttu-id="d9b06-154">인증 쿠키를 전송 하는 SSL 연결이 필요한 지 여부를 나타내는 부울 값입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-154">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="d9b06-155">기본값은 false입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-155">The default value is false.</span></span> |
| <span data-ttu-id="d9b06-156">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="d9b06-156">slidingExpiration</span></span> | <span data-ttu-id="d9b06-157">사용자가 단일 세션에서 사이트를 방문할 인증 쿠키 s 시간 초과 될 때마다 다시 설정 하는지 여부를 나타내는 부울 값입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-157">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="d9b06-158">기본값은 true입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-158">The default value is true.</span></span> <span data-ttu-id="d9b06-159">인증 티켓 시간 제한 정책에는 지정 하면 보다 자세히 설명 되어 티켓 시간 제한 값 섹션 s입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-159">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span> |
| <span data-ttu-id="d9b06-160">시간 제한</span><span class="sxs-lookup"><span data-stu-id="d9b06-160">timeout</span></span> | <span data-ttu-id="d9b06-161">인증 티켓 쿠키가 만료 된 후 분 후에는 시간을 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-161">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="d9b06-162">기본값은 30입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-162">The default value is 30.</span></span> <span data-ttu-id="d9b06-163">인증 티켓 시간 제한 정책에는 지정 하면 보다 자세히 설명 되어 티켓 시간 제한 값 섹션 s입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-163">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span> |

<span data-ttu-id="d9b06-164">**표 1**: A 요약은 &lt;forms&gt; 요소의 특성</span><span class="sxs-lookup"><span data-stu-id="d9b06-164">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="d9b06-165">ASP.NET 2.0 이상, 기본 폼 인증 값 FormsAuthenticationConfiguration 클래스는.NET Framework에서 하드 코드 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-165">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="d9b06-166">모든 수정 Web.config 파일에서 응용 프로그램에서 응용 프로그램 별로 적용 되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-166">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="d9b06-167">ASP.NET이 점에서 차이가 1.x, 여기서 폼 인증 기본값 machine.config 파일에 저장 된 (및 따라서 machine.config를 편집을 통해 수정할 수 있습니다).</span><span class="sxs-lookup"><span data-stu-id="d9b06-167">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="d9b06-168">ASP.NET의 주제 시 1.x는 것이 좋은지를 언급 하기 위해 다양 한 폼 인증 시스템 설정 ASP.NET 2.0에서 다양 한 기본 값을 갖도록 및 ASP.NET에서 보다 그 이상 1.x 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-168">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="d9b06-169">ASP.NET 1.x 환경에서 응용 프로그램을 마이그레이션하려는 경우에 이러한 차이에 주의 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-169">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="d9b06-170">참조 [는 &lt;forms&gt; 요소 기술 문서](https://msdn.microsoft.com/en-us/library/1d3t3c61.aspx) 차이점 목록에 대 한 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-170">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/en-us/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-171">결과 폼 인증 티켓 쿠키에 대 한 세부 정보를 지정 하는 시간 제한, 도메인 및 경로 같은 여러 폼 인증 설정.</span><span class="sxs-lookup"><span data-stu-id="d9b06-171">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="d9b06-172">에 대 한 자세한 내용은 쿠키, 작동 방법 및 다양 한 속성을 [이 쿠키 자습서](http://www.quirksmode.org/js/cookies.html)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-172">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="d9b06-173">티켓의 시간 제한 값 지정</span><span class="sxs-lookup"><span data-stu-id="d9b06-173">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="d9b06-174">폼 인증 티켓에는 id를 나타내는 토큰입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-174">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="d9b06-175">쿠키 기반 인증 티켓으로이 토큰은 쿠키의 형태로 유지 되 고 각 요청에 대해 웹 서버로 전송 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-175">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="d9b06-176">토큰 소유 여부는 사실, 선언, 저는 *username*에 이미 로그인 한 했으며 방문 페이지에서 사용자의 id를 기억할 수 있도록 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-176">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="d9b06-177">폼 인증 티켓 사용자의 id를 포함 합니다. 뿐만 아니라도 무결성 및 보안 토큰의 유용한 정보를 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-177">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="d9b06-178">즉, 돌파 유효한 토큰 underhanded 어떤 방식으로든에서 수정 하거나 불법 토큰을 만들 수 원하는 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-178">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="d9b06-179">티켓에 포함 되는 정보의 이러한 1 비트는는 *만료*, 이것은 날짜 및 시간 티켓은 더 이상 유효 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-179">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="d9b06-180">인증 티켓을 검사 하는 FormsAuthenticationModule 때마다 티켓의 만료 아직 전달 되지 않은 되도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-180">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="d9b06-181">있는 경우, 티켓을 무시 하 고 익명으로 사용자를 식별 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-181">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="d9b06-182">이러한 안전 장치는 재생 공격 으로부터 보호 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-182">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="d9b06-183">해커가 자신의 컴퓨터에 대 한 실제 액세스를 확보 하 고 해당 쿠키를 통해 루 팅 여 아마도 그녀의 관련 한 실질적인-사용자의 유효한 인증 티켓을 가져올 수-이 훔친된 인증 티켓을 사용 하 여 서버에는 요청을 보낼 수 있습니다 하는 경우에 만료 없이 및 항목을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-183">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="d9b06-184">만료가이 시나리오를 방지 하지 않는 동안는 이러한 공격 성공할 수 있는 창을 제한 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-184">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-185">폼 인증 시스템에서 인증 티켓을 보호 하기 위해 사용 하는 세부 정보 추가 기술의 3 단계.</span><span class="sxs-lookup"><span data-stu-id="d9b06-185">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="d9b06-186">인증 티켓을 만들 때 폼 인증 시스템의 만료 시간 제한 설정을 참조 하 여 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-186">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="d9b06-187">표 1, 설정이 기본적으로 30 분 시간 제한에서에서 설명한 것 처럼 폼 인증 티켓 만들어질 때의 만료 날짜 및 시간 앞으로 30 분으로 설정 한다는 의미입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-187">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="d9b06-188">만료 된 절대 시간 앞으로 폼 인증 티켓 만료 될 때를 정의 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-188">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="d9b06-189">하지만 일반적으로 개발자는 사용자는 사이트 다시 검토 하 여 될 때마다 다시 설정 하는 슬라이딩 만료를 구현 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-189">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="d9b06-190">이 동작은 slidingexpiration이 설정에 따라 결정 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-190">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="d9b06-191">경우 true로 설정 (기본값) 이면 사용자를 인증 하는 FormsAuthenticationModule 될 때마다 업데이트 티켓의 만료 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-191">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="d9b06-192">각 요청에 대해 업데이트 되지 않습니다 만료 false로 설정 하는 경우 티켓을 티켓 처음 경과 된 분 수 정확 하 게 제한 시간 만료로 인해 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-192">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-193">인증 티켓에 저장 된 만료 절대 날짜 및 시간 값을 2008 년 8 월 2 일 오전 11시 34분 같은 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-193">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="d9b06-194">또한, 날짜 및 시간 웹 서버의 현지 시간 기준 으로합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-194">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="d9b06-195">이 디자인 결정에 따라 몇 가지 흥미로운 부작용 주위 일광 절약 시간제 DST (), United States의 시계를 이동할 때 계속 1 시간 (웹 서버는 일광 절약 시간제 관찰 되는 로캘에서 호스팅되는 경우)이 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-195">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="d9b06-196">근처 DST 시작 되는 시간 30 분 만료 된 ASP.NET 웹 사이트에 대 한 어떻게 될 지는 것이 좋습니다 (않는 오전 2 시에).</span><span class="sxs-lookup"><span data-stu-id="d9b06-196">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="d9b06-197">방문자가 사이트에 로그온 2008 년 3 월 11 일 오전 1 시 55 가정해 보세요.</span><span class="sxs-lookup"><span data-stu-id="d9b06-197">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="d9b06-198">이 오전 2 시 25 (30 분에 나중에 해당) 2008 년 3 월 11 일에 만료 되는 폼 인증 티켓을 생성 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-198">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="d9b06-199">그러나 오전 2시 시점이, 클록 처리기로 이동 오전 3시 DST 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-199">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="d9b06-200">사용자 (오전 3시 01분)에서 로그인 한 후 6 분 후 새 페이지를 로드 하는 경우 티켓 만료 되 고 사용자의 로그인 페이지를 리디렉션합니다.는 FormsAuthenticationModule 인식 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-200">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="d9b06-201">Stefan Schackow의 복사본을 선택에 대 한 보다 철저 한 내용은이 및 다른 인증 티켓 시간 제한 의문 사항을으로 해결 방법, *Professional ASP.NET 2.0 보안, 구성원 자격 및 역할 관리* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="d9b06-201">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="d9b06-202">그림 1 slidingexpiration이 false로 설정 되 고 시간 제한은 30으로 설정 하는 경우 워크플로 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-202">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="d9b06-203">로그인 할 때 생성 된 인증 티켓이 만료 날짜를 포함 하 고 이후 요청에서이 값은 업데이트 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-203">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="d9b06-204">FormsAuthenticationModule 티켓이 만료 되었습니다을 발견할 경우을 무시 하 고 익명으로 요청을 처리 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-204">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="d9b06-205">[![그래픽으로 폼 인증 티켓 만료 때 slidingExpiration이 false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-205">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="d9b06-206">**그림 01**: A 그래픽으로 폼 인증 티켓 만료 때 slidingExpiration이 false ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-206">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>


<span data-ttu-id="d9b06-207">그림 2 slidingExpiration로 설정 된 경우 워크플로가 나와 true 및 제한 시간 30으로 설정 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-207">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="d9b06-208">(만료 되지 않은 티켓)으로 인증 된 요청을 받으면 해당 만료 시간 (분) 이후에 시간 초과 수로 업데이트 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-208">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="d9b06-209">[![폼 인증 티켓의 그래픽 표현을 slidingExpiration 중 하면](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-209">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="d9b06-210">**그림 02**: 폼 인증 티켓의 그래픽 표현을 A slidingExpiration가 true ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-210">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>


<span data-ttu-id="d9b06-211">쿠키 기반 인증 티켓 (기본값)를 사용할 때이 토론 쿠키 지정 자신의 expiries 있을 수도 있습니다 때문에 다소 혼동 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-211">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="d9b06-212">쿠키의 만료 (또는 결핍) 쿠키를 제거 해야 하는 경우 브라우저에 지시 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-212">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="d9b06-213">쿠키가 없는 경우 expiry, 브라우저 종료 될 때 소멸 되기 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-213">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="d9b06-214">그러나 만료가 있는 경우 날짜까지 쿠키는 사용자의 컴퓨터에 저장 및 만료에 지정 된 시간이 지나면 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-214">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="d9b06-215">브라우저에서 쿠키 소멸 될 때 더 이상 웹 서버에 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-215">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="d9b06-216">따라서 쿠키의 소멸은 사용자 사이트에서 로깅 비슷합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-216">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-217">물론, 사용자의 컴퓨터에 저장 된 쿠키를 적극적으로 제거할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-217">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="d9b06-218">Internet Explorer 7, 도구, 옵션로 이동 하 고 탐색 기록 구역에서 삭제 단추를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-218">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="d9b06-219">여기에서 삭제 쿠키 단추를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-219">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="d9b06-220">폼 인증 시스템에 전달 되는 값에 따라 세션 또는 만료 기반 쿠키를 만듭니다는 *persistCookie* 매개 변수입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-220">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="d9b06-221">두 입력된 매개 변수에서 FormsAuthentication 클래스 GetAuthCookie, SetAuthCookie, 및 RedirectFromLoginPage 메서드를 사용 하는 회수: *username* 및 *persistCookie*합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-221">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="d9b06-222">이전 자습서에서 만든 로그인 페이지 포함 암호 저장 CheckBox 영구 쿠키 생성 되는지 여부를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-222">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="d9b06-223">영구 쿠키는 만료부터 시작 합니다. 비 영구적인 쿠키는 세션 기반입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-223">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="d9b06-224">앞에서 설명한 제한 시간 및 slidingExpiration 개념 두 세션 및 만료 기반 쿠키에 동일 하 게 적용 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-224">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="d9b06-225">실행에 사소한 차이점이 하나만: true로 설정 된 slidingTimeout 함께 만료 기반 쿠키를 사용 하면 쿠키의 만료만 업데이트 됩니다 경과 된 시간 중 절반 이상.</span><span class="sxs-lookup"><span data-stu-id="d9b06-225">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="d9b06-226">슬라이딩 만료를 사용 하 여 제한 시간 (60 분)을 1 시간 후 티켓을 할당 하는 웹 사이트의 인증 티켓 시간 제한 정책 업데이트 하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-226">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="d9b06-227">이 변경 내용을 적용, Web.config 파일을 업데이트 하려면 추가 &lt;forms&gt; 요소에는 &lt;인증&gt; 요소를 다음 태그로:</span><span class="sxs-lookup"><span data-stu-id="d9b06-227">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="d9b06-228">Login.aspx 이외의 로그인 페이지 URL을 사용 하 여</span><span class="sxs-lookup"><span data-stu-id="d9b06-228">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="d9b06-229">FormsAuthenticationModule 권한이 없는 사용자가 로그인 페이지로 자동으로 리디렉션합니다, 이후 로그인 페이지의 URL을 알고 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-229">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="d9b06-230">이 URL에서 로그인 Url 특성에 지정 된는 &lt;forms&gt; 요소 및 기본값은 login.aspx입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-230">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="d9b06-231">기존 웹 사이트를 통해 이식 하는 경우 이미 책갈피가 설정 및 검색 엔진 있는 다른 URL로 로그인 페이지를 이미 있을 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-231">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="d9b06-232">기존 로그인 페이지를 login.aspx 이름 바꾸기 링크와 사용자의 책갈피를 분리 하는 대신 로그인 페이지를 가리키도록 loginUrl 특성 대신 수정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-232">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="d9b06-233">예를 들어 로그인 페이지 SignIn.aspx 변수의 이름이 사용자 디렉터리에 있는 경우 로그인 Url 구성 설정 ~/Users/SignIn.aspx 가리킬 수 같이:</span><span class="sxs-lookup"><span data-stu-id="d9b06-233">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="d9b06-234">없기 때문에 이미 현재 응용 프로그램에 Login.aspx 라는 로그인 페이지에 사용자 지정 값을 지정할 필요가 없습니다는 &lt;forms&gt; 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-234">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="d9b06-235">Cookieless 폼 인증 티켓을 사용 하 여 2 단계:</span><span class="sxs-lookup"><span data-stu-id="d9b06-235">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="d9b06-236">기본적으로 폼 인증 시스템 쿠키 컬렉션에 해당 인증 티켓을 저장 하거나 사이트를 방문 하는 사용자 에이전트에 따라 URL에 포함 여부를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-236">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="d9b06-237">기본 지원 데스크톱 브라우저의 경우 모든 Internet Explorer, Firefox, Opera, 및 Safari, 지원 쿠키 비슷하지만 되지 모든 모바일 장치 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-237">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="d9b06-238">폼 인증 시스템에서 사용 하는 쿠키 정책이의 쿠키 설정에 따라는 &lt;forms&gt; 요소를 지정할 수 있는 4 개의 값 중 하나:</span><span class="sxs-lookup"><span data-stu-id="d9b06-238">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="d9b06-239">UseCookies-쿠키 기반 인증 티켓 항상 사용될지를 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-239">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="d9b06-240">UseUri-쿠키 기반 인증 티켓 사용 되지 않습니다 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-240">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="d9b06-241">자동 검색-장치 프로필 쿠키, 쿠키 기반 인증 티켓을 지원 하지 않는 경우 사용 되지 않습니다. 장치 프로필에서 쿠키를 지 원하는 경우 쿠키는 사용할 수 있는지 확인 하는 프로브 메커니즘 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-241">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="d9b06-242">UseDeviceProfile-기본; 장치 프로필에서 쿠키를 지원 하는 경우에 쿠키 기반 인증 티켓을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-242">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="d9b06-243">검색 메커니즘이 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-243">No probing mechanism is used.</span></span>

<span data-ttu-id="d9b06-244">자동 검색 및 UseDeviceProfile 설정을 의존는 *장치 프로필* 쿠키 기반 또는 쿠키 인증 티켓을 사용할 것인지를 구축 방향을 얻기 위한에서.</span><span class="sxs-lookup"><span data-stu-id="d9b06-244">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="d9b06-245">ASP.NET에는 다양 한 장치와 기능, 쿠키를 지원 하는지 여부, 버전을 지 원하는 JavaScript 등과 같은 데이터베이스 유지 관리 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-245">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="d9b06-246">될 때마다 장치에서 웹 페이지를 따라 보내는 웹 서버에서 요청 된 *사용자 에이전트* 장치 유형을 식별 하는 HTTP 헤더입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-246">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="d9b06-247">ASP.NET 해당 프로필이 해당 데이터베이스에 제공 된 사용자 에이전트 문자열을 자동으로 일치 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-247">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-248">이 데이터베이스의 장치 기능을 준수 하는 여러 개의 XML 파일에에서 저장 됩니다는 [브라우저 정의 파일 스키마](https://msdn.microsoft.com/en-us/library/ms228122.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-248">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/en-us/library/ms228122.aspx).</span></span> <span data-ttu-id="d9b06-249">기본 장치 프로필 파일 %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers에서 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-249">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="d9b06-250">응용 프로그램의 응용 프로그램에 사용자 지정 파일을 추가할 수도 있습니다\_브라우저 폴더입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-250">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="d9b06-251">자세한 내용은 참조 [방법: ASP.NET 웹 페이지에서 브라우저 종류를 검색](https://msdn.microsoft.com/en-us/library/3yekbd5b.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-251">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/en-us/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="d9b06-252">기본 설정은 UseDeviceProfile 이기 때문에 쿠키가 없는 폼 인증 티켓 장치 프로필이 쿠키를 지원 하지 않으면 보고 사이트를 방문 하는 경우 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-252">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="d9b06-253">URL에서 인증 티켓 인코딩</span><span class="sxs-lookup"><span data-stu-id="d9b06-253">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="d9b06-254">쿠키는 브라우저에서 정보를 포함 하 여 기본 폼 인증 설정 방문 장치가 지 원하는 경우 쿠키를 사용 하는 이유는 특정 웹 사이트에 각 요청에 대 한 자연 보통입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-254">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="d9b06-255">쿠키 지원 되지 않는 경우 서버에 클라이언트에서 인증 티켓을 전달 하기 위한 방법 채택 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-255">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="d9b06-256">쿠키가 없는 환경에서 사용 되는 일반적인 해결 방법은 URL에 쿠키 데이터를 인코딩하려면 되려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-256">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="d9b06-257">URL 내의 등의 정보가 포함 될 수 있습니다 어떻게 볼 수 없는 인증 티켓을 사용 하도록 사이트를 강제로 가장 좋은 방법은 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-257">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="d9b06-258">UseUri cookieless 구성 설정을 설정 하 여이 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-258">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="d9b06-259">이 변경 내용을 적용 하 고 나면 브라우저를 통해 사이트를 방문 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-259">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="d9b06-260">익명 사용자로 방문 하면 Url 전과 정확히 일치 보입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-260">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="d9b06-261">예를 들어 Default.aspx 페이지를 방문 하는 경우 내 브라우저의 주소 표시줄에 다음 URL 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-261">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="d9b06-262">그러나 로그인 시 폼 인증 티켓 URL에 포함 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-262">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="d9b06-263">예를 들어 로그인 페이지를 방문 하 고 Sam로 로그인 후 Default.aspx 페이지에 반환 되 고 I 있지만 URL이 시간은:</span><span class="sxs-lookup"><span data-stu-id="d9b06-263">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="d9b06-264">URL 내에서 폼 인증 티켓에 포함 된 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-264">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="d9b06-265">문자열 (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) 쿠키 내에서 주로 저장 되는 동일한 데이터 이며 16 진수로 인코딩된 인증 티켓 정보를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-265">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="d9b06-266">작동 하도록 쿠키 인증 티켓을 위해 시스템에 인증 티켓 데이터를 포함 하는 페이지에 있는 모든 Url 인코딩해야 합니다., 그렇지 않으면 인증 티켓 것입니다 손실 링크를 클릭할 때입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-266">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="d9b06-267">다행히도 포함이 논리는 자동으로 수행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-267">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="d9b06-268">이 기능을 보여 주기 위해 Default.aspx 페이지를 열고 테스트 연결 및 SomePage.aspx, 텍스트 및 NavigateUrl 속성을 각각 설정 하이퍼링크 컨트롤을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-268">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="d9b06-269">실제로 아님을 페이지 SomePage.aspx 라는 프로젝트에 문제가 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-269">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="d9b06-270">Default.aspx의 변경 내용을 저장 한 후 브라우저를 통해 방문 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-270">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="d9b06-271">폼 인증 티켓 URL에 포함 하는 사이트에 로그온 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-271">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="d9b06-272">그런 다음 Default.aspx를에서 링크 테스트 링크를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-272">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="d9b06-273">어떻게 된 것입니까?</span><span class="sxs-lookup"><span data-stu-id="d9b06-273">What happened?</span></span> <span data-ttu-id="d9b06-274">SomePage.aspx 라는 페이지가 없는 경우 404 오류 발생 후 수 있지만 것이 아니라 중요 한 여기.</span><span class="sxs-lookup"><span data-stu-id="d9b06-274">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="d9b06-275">대신, 브라우저의 주소 표시줄에 집중 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-275">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="d9b06-276">URL에서 폼 인증 티켓을 포함 하는 참고!</span><span class="sxs-lookup"><span data-stu-id="d9b06-276">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="d9b06-277">링크의 URL SomePage.aspx 인증 티켓-를 포함 하는 URL에 자동으로 변환 필요는 전혀 없고 코드가 전혀 작성!</span><span class="sxs-lookup"><span data-stu-id="d9b06-277">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="d9b06-278">Http://로 시작 하는 모든 하이퍼링크에 대 한 URL에 자동으로 포함 될 폼 인증 티켓 또는 /.</span><span class="sxs-lookup"><span data-stu-id="d9b06-278">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="d9b06-279">Response.Redirect에 대 한 호출, 하이퍼링크 컨트롤 또는 HTML 앵커 요소 하이퍼링크가 표시 되 면 문제가 되지 않습니다 (즉, &lt;는 href = "..."&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="d9b06-279">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="d9b06-280">URL 예 http://www.someserver.com/SomePage.aspx 또는 /SomePage.aspx 아닌,으로 폼 인증 티켓을 수행해 줍니다 포함 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-280">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-281">Cookieless 폼 인증 티켓을 동일한 쿠키 기반 인증 티켓 시간 제한 정책을 준수합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-281">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="d9b06-282">그러나 쿠키 인증 티켓은 URL에서 직접 인증 티켓이 포함 되어 있으므로 재생 공격 가능성이 더 큽니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-282">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="d9b06-283">사용자가 웹 사이트를 방문 하 고, 로그인 동료에 게 전자 메일에 URL을 붙여 다음 가정해 보세요.</span><span class="sxs-lookup"><span data-stu-id="d9b06-283">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="d9b06-284">동료는 만료에 도달 하기 전에 해당 링크를 클릭, 하는 경우 이러한로 기록 됩니다 전자 메일을 보낸 사용자에 게!</span><span class="sxs-lookup"><span data-stu-id="d9b06-284">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="d9b06-285">3 단계: 보안 인증 티켓을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-285">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="d9b06-286">폼 인증 티켓은 네트워크를 통해 전송 되 쿠키에 하나 또는 URL 내에 직접 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-286">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="d9b06-287">Id 정보 외에도 인증 티켓이 포함 될 수 있습니다 사용자 데이터 (4 단계에서에서 알 수)입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-287">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="d9b06-288">따라서 중요 한 티켓의 데이터는 암호화는 침입자 및 (중요) 하는 폼 인증 시스템 티켓으로 손상 되지 않았음을 보장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-288">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="d9b06-289">티켓의 데이터의 개인 정보 보호를 보장 하려면 폼 인증 시스템에서 티켓 데이터를 암호화할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-289">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="d9b06-290">티켓 데이터를 암호화를 일반 텍스트로 네트워크를 통해 잠재적으로 중요 한 정보를 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-290">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="d9b06-291">폼 인증 시스템 해야 티켓의 신뢰성을 보장 하려면 *유효성을 검사* 티켓입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-291">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="d9b06-292">유효성 검사는 데이터의 특정 부분 수정 되지 않은 하 고이 통해 수행 하는 작업을  *[메시지 인증 코드 (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-292">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="d9b06-293">간단히 말해서 MAC은 작은 부분에 (이 경우 티켓) 유효성을 검사 해야 하는 데이터를 식별 하는 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-293">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="d9b06-294">MAC에서 나타내는 데이터 수정 되 면 다음 MAC 및 데이터는 일치 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-294">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="d9b06-295">또한 계산을 통해 데이터를 수정 하 고 수정된 된 데이터와 일치 하도록 자신의 MAC 생성 해커가 하드도 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-295">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="d9b06-296">만드는 (또는 수정 하 고) 하는 경우 티켓을 폼 인증 시스템 MAC 만들고 티켓의 데이터에 연결 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-296">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="d9b06-297">후속 요청이 도착 하면 폼 인증 시스템에서 티켓 데이터의 신뢰성을 확인할 MAC 및 티켓 데이터를 비교 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-297">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="d9b06-298">그림 3이이 워크플로 그래픽으로 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-298">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="d9b06-299">[![MAC을 통해 티켓의 신뢰성은 보장](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-299">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="d9b06-300">**그림 03**: The 티켓의 신뢰성은 MAC를 통해 보장 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-300">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>


<span data-ttu-id="d9b06-301">보호 설정에 따라 어떤 보안 조치 인증 티켓에 적용 되는 &lt;forms&gt; 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-301">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9b06-302">다음 세 가지 값 중 하나에서 보호 설정을 할당 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-302">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="d9b06-303">모든-티켓 모두 암호화 및 디지털 서명 않았습니다 (기본값).</span><span class="sxs-lookup"><span data-stu-id="d9b06-303">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="d9b06-304">암호화-암호화만 적용 되-없습니다 MAC이 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-304">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="d9b06-305">None-티켓은 암호화 되거나 되지 디지털 서명 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-305">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="d9b06-306">유효성 검사-MAC를 생성할 수 있지만 티켓 데이터를 일반 텍스트로 네트워크를 통해 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-306">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="d9b06-307">모든 설정을 사용 하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-307">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="d9b06-308">유효성 검사 및 암호 해독 키를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-308">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="d9b06-309">암호화 및 해시를 암호화 하 여 인증 티켓의 유효성을 검사 폼 인증 시스템에서 사용 하는 알고리즘은을 통해 사용자 지정할 수는 [ &lt;machineKey&gt; 요소](https://msdn.microsoft.com/en-us/library/w8h3skw9.aspx) Web.config에 있습니다. 표 2 윤곽선은 &lt;machineKey&gt; 요소의 특성 및 가능한 값입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-309">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/en-us/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="d9b06-310">**특성**</span><span class="sxs-lookup"><span data-stu-id="d9b06-310">**Attribute**</span></span> | <span data-ttu-id="d9b06-311">**설명**</span><span class="sxs-lookup"><span data-stu-id="d9b06-311">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="d9b06-312">해독</span><span class="sxs-lookup"><span data-stu-id="d9b06-312">decryption</span></span> | <span data-ttu-id="d9b06-313">암호화에 사용 되는 알고리즘을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-313">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="d9b06-314">이 특성은 다음 네 가지 값 중 하나일 수 있습니다.-자동-기본; decryptionKey 특성의 길이에 따라 알고리즘을 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-314">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="d9b06-315">-AES-사용 하 여는 [표준 AES (고급 암호화)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) 알고리즘입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-315">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="d9b06-316">-DES를 사용 하는 [표준 DES (데이터 암호화)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) 이 알고리즘 계산 강력 하지 않은 것으로 간주 됩니다 하 고 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-316">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="d9b06-317">-3DES-사용 하 여는 [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) 알고리즘을 세 번 DES 알고리즘을 적용 하 여 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-317">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="d9b06-318">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="d9b06-318">decryptionKey</span></span> | <span data-ttu-id="d9b06-319">암호화 알고리즘에서 사용 하는 비밀 키입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-319">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="d9b06-320">이 값 이어야 합니다. (암호 해독의 값에 기반) 적절 한 길이, AutoGenerate, 또는 두 값 중 하나를 함께 추가의 16 진수 문자열 IsolateApps 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-320">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="d9b06-321">각 응용 프로그램에 대 한 고유 값을 사용 하도록 ASP.NET에 지시 IsolateApps를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-321">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="d9b06-322">기본값은 AutoGenerate, IsolateApps 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-322">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="d9b06-323">유효성 검사</span><span class="sxs-lookup"><span data-stu-id="d9b06-323">validation</span></span> | <span data-ttu-id="d9b06-324">유효성 검사에 사용 되는 알고리즘을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-324">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="d9b06-325">이 특성은 다음 네 가지 값 중 하나일 수 있습니다.-AES-암호화 표준 AES (고급) 알고리즘을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-325">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="d9b06-326">-M d 5-사용 하 여는 [Message-digest MD5 (5)](http://en.wikipedia.org/wiki/MD5) 알고리즘입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-326">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="d9b06-327">-S h a 1-사용 하 여는 [SHA1](http://en.wikipedia.org/wiki/Sha1) 알고리즘 (기본값).</span><span class="sxs-lookup"><span data-stu-id="d9b06-327">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="d9b06-328">-3DES-Triple DES 알고리즘을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-328">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="d9b06-329">validationKey</span><span class="sxs-lookup"><span data-stu-id="d9b06-329">validationKey</span></span> | <span data-ttu-id="d9b06-330">유효성 검사 알고리즘에서 사용 하는 비밀 키입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-330">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="d9b06-331">이 값 이어야 합니다 (유효성 검사에 대 한 값에 기반) 적절 한 길이, AutoGenerate, 또는 두 값 중 하나를 함께 추가의 16 진수 문자열 IsolateApps 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-331">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="d9b06-332">각 응용 프로그램에 대 한 고유 값을 사용 하도록 ASP.NET에 지시 IsolateApps를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-332">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="d9b06-333">기본값은 AutoGenerate, IsolateApps 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-333">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="d9b06-334">**표 2**:는 &lt;machineKey&gt; 요소 특성</span><span class="sxs-lookup"><span data-stu-id="d9b06-334">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="d9b06-335">다양 한 알고리즘의 장단점 이러한 암호화 및 유효성 검사 옵션 및 전문가 대 한 자세한 설명은이 자습서의 범위를 벗어납니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-335">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="d9b06-336">심층 분석 확인을 사용 하려면 어떤 암호화 및 유효성 검사 알고리즘에 대 한 지침을 포함 하 여 이러한 문제를 사용 하려면 어떤 키 길이 대 한 참조, 이러한 키를 생성 하는 최선의 방법 및 *Professional ASP.NET 2.0 보안, 구성원 자격 및 역할 관리* .</span><span class="sxs-lookup"><span data-stu-id="d9b06-336">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="d9b06-337">기본적으로 암호화 및 유효성 검사에 사용 되는 키 각 응용 프로그램에 대 한 자동으로 생성 되 고 이러한 키에는 로컬 보안 기관 (LSA)에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-337">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="d9b06-338">즉, 기본 설정을 웹 서버-웹 서버와 응용 프로그램에서 응용 프로그램 별로에 고유 키를 보장 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-338">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="d9b06-339">따라서 이러한 기본 동작은 두 다음과 같은 시나리오에서 작동 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-339">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="d9b06-340">**웹 팜** -는 [웹 팜](http://en.wikipedia.org/wiki/Web_farm) 시나리오에서는 단일 웹 응용 프로그램 확장성 및 중복성의 목적을 위해 여러 웹 서버에서 호스팅됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-340">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="d9b06-341">들어오는 각 요청은 사용자 세션의 수명 주기 동안 서로 다른 서버 있습니다 사용할 수 그의 다양 한 요청을 처리 하는 팜의 서버에 전달 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-341">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="d9b06-342">따라서 각 서버는 폼 인증 티켓 만들어지도록 동일한 암호화 및 유효성 검사 키를 사용 해야에서 유효성을 검사 하 여 암호화를 하나 서버를 암호 해독 하 고 팜의 다른 서버에서 유효성을 검사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-342">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="d9b06-343">**응용 프로그램 티켓 공유 교차** -단일 웹 서버는 여러 ASP.NET 응용 프로그램을 호스팅할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-343">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="d9b06-344">이러한 다른 응용 프로그램의 단일 폼 인증 티켓을 공유 해야 할 경우 반드시 해당 암호화 및 유효성 검사 키 맞춰야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-344">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="d9b06-345">웹 팜 설정 하거나 동일한 서버에 응용 프로그램에서 인증 티켓을 공유를 사용할 때는 구성 해야 합니다는 &lt;machineKey&gt; 영향을 받는 응용 프로그램의 요소를 자신의 decryptionKey 및 validationKey 값이 일치 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-345">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="d9b06-346">위의 시나리오 중 어느 샘플 응용 프로그램에 적용 되지만, 우리 여전히 명시적 decryptionKey 및 validationKey 값을 지정 하 고 정의할 수 알고리즘을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-346">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="d9b06-347">추가 &lt;machineKey&gt; Web.config 파일에 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-347">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="d9b06-348">자세한 내용은 체크 아웃 [방법: ASP.NET 2.0에서 MachineKey 구성](https://msdn.microsoft.com/en-us/library/ms998288.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-348">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/en-us/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-349">DecryptionKey 및 validationKey 값에서 발췌 한 것 [Steve Gibson](http://www.grc.com/stevegibson.htm)의 [완벽 한 암호 웹 페이지](https://www.grc.com/passwords.htm), 각 페이지 방문에 임의의 16 진수 문자 64을 생성 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-349">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="d9b06-350">프로덕션 응용 프로그램에 자체 방식을 만들지 이러한 키의 가능성을 줄이기 위해 완벽 한 암호 페이지에서 임의로 생성 된 값과 위의 키를 대체 하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-350">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="d9b06-351">티켓의 추가 사용자 데이터를 저장 하는 4 단계:</span><span class="sxs-lookup"><span data-stu-id="d9b06-351">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="d9b06-352">많은 웹 응용 프로그램에 대 한 정보를 표시 하거나 현재 로그온된 한 사용자를 기준으로 페이지의 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-352">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="d9b06-353">예를 들어 웹 페이지는 사용자의 이름 및 모든 페이지의 맨 위에 있는 마지막 로그온 날짜를 표시할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-353">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="d9b06-354">폼 인증 티켓 현재 로그온된 한 사용자의 사용자 이름을 저장 하지만 페이지 인증 티켓에 저장 되지 않은 정보를 조회 하는 사용자-데이터베이스-저장소로 이동 해야 다른 정보가 필요할 때.</span><span class="sxs-lookup"><span data-stu-id="d9b06-354">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="d9b06-355">약간의 코드 사용에서는 폼 인증 티켓의 추가 사용자 정보를 저장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-355">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="d9b06-356">통해 이러한 데이터를 표시할 수는 [FormsAuthenticationTicket 클래스](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.aspx)의 [UserData 속성](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.userdata.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-356">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="d9b06-357">이 적은 양의 일반적으로 필요한 사용자에 대 한 정보를 저장 하는 유용한 장소가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-357">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="d9b06-358">속성의 인증 티켓 쿠키 하 고, 다른 티켓 필드와 같은 일부 포함 되어, 정책이 암호화 되어 유효성을 검사할 사용자 데이터에 지정 된 값 폼 인증 시스템 구성을 기반으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-358">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="d9b06-359">기본적으로 UserData은 빈 문자열입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-359">By default, UserData is an empty string.</span></span>

<span data-ttu-id="d9b06-360">인증 티켓에 사용자 데이터를 저장 하기 위해 사용자 관련 정보를 가져와 고 티켓에 저장 하는 로그인 페이지에서 약간의 코드를 작성 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-360">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="d9b06-361">사용자 데이터는 String 형식의 속성 이기 때문에 저장 된 데이터를 문자열로 제대로 직렬화 되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-361">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="d9b06-362">예를 들어 사용자 저장소, 직원의 이름과 각 사용자의 생년월일을 포함 하 고 인증 티켓에 이러한 두 속성 값을 저장 한다고 가정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-362">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="d9b06-363">고용주 이름을 파이프 (|)와 출생의 문자열의 사용자의 날짜를 연결 하 여 이러한 값을 문자열로 serialize 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-363">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="d9b06-364">사용자의 1974 년 8 월 15에 태어난 Northwind Traders에 사용 중인 경우에서는 할당 UserData 속성 문자열: 1974-08-15 | Northwind Traders 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-364">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="d9b06-365">티켓에 저장 된 데이터에 액세스 해야 할 때마다 현재 요청 FormsAuthenticationTicket 위치와 UserData 속성을 역직렬화 그렇게 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-365">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="d9b06-366">생년월일 및 고용주 이름 예제에서는 날짜의 경우 UserData 문자열 구분 기호 (|)에 따라 두 부분 문자열을 분할할 것 했습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-366">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="d9b06-367">[![인증 티켓에 추가 사용자 정보를 저장할 수 있습니다.](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-367">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="d9b06-368">**그림 04**: 추가 사용자 정보에에서 저장할 수 인증 티켓 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-368">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="d9b06-369">사용자 데이터에 정보를 기록</span><span class="sxs-lookup"><span data-stu-id="d9b06-369">Writing Information to UserData</span></span>

<span data-ttu-id="d9b06-370">그러나, 폼 인증 티켓에 사용자 관련 정보를 추가 된다고 예상 만큼 간단 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-370">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="d9b06-371">FormsAuthenticationTicket 클래스의 UserData 속성은 읽기 전용 이며 FormsAuthenticationTicket 클래스 생성자를 통해 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-371">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="d9b06-372">또한 티켓의 다른 값을 제공 해야 UserData 속성을 생성자에 지정 하는 경우: 사용자 이름, 발급일, 만료, 및 등입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-372">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="d9b06-373">이전 자습서에서 로그인 페이지를 만들 때이 모든을 수행해 줍니다에 의해 처리 되었는지 FormsAuthentication 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-373">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="d9b06-374">사용자 데이터에는 FormsAuthenticationTicket를 추가할 때는 대부분의 FormsAuthentication 클래스에 의해 제공 기능을 복제 하는 코드를 작성 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-374">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="d9b06-375">인증 티켓에 사용자에 대 한 추가 정보를 기록 Login.aspx 페이지를 업데이트 하 여 UserData로 작업 하는 데 필요한 코드를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-375">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="d9b06-376">사용자가 스토어에 대 한 사용자가는 회사 및 해당 제목에 대 한 정보를 포함 하 고 인증 티켓에서이 정보를 캡처하려면 한다고 이라고 가정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-376">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="d9b06-377">코드는 다음과 같이 표시 되도록 Login.aspx 페이지 LoginButton Click 이벤트 처리기를 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-377">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="d9b06-378">한 번에 한 줄씩 코드가 단계별로 실행 해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-378">Let's step through this code one line at a time.</span></span> <span data-ttu-id="d9b06-379">메서드 4 개의 문자열 배열을 정의 하 여 시작: 사용자, 암호, companyName 및 titleAtCompany 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-379">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="d9b06-380">이러한 배열은 저장할 사용자 이름, 암호, 회사 이름 및 사용자 계정에 대 한 제목 시스템에서의 세 가지는: Scott, Jisun, 및 Sam 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-380">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="d9b06-381">실제 응용 프로그램에서 하지 하드 코드 된 페이지의 소스 코드에서 사용자 저장소에서 이러한 값은 쿼리할 수는.</span><span class="sxs-lookup"><span data-stu-id="d9b06-381">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="d9b06-382">이전 자습서에서 제공 된 자격 증명이 유효 하는 경우 단순히 호출을 다음 단계를 수행한 FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked):</span><span class="sxs-lookup"><span data-stu-id="d9b06-382">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="d9b06-383">폼 인증 티켓 생성</span><span class="sxs-lookup"><span data-stu-id="d9b06-383">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="d9b06-384">적절 한 저장소를에 티켓을 썼습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-384">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="d9b06-385">쿠키 기반 인증 티켓에 대 한 브라우저의 쿠키 컬렉션을 사용 합니다. 티켓 데이터 URL로 serialize 되 쿠키 인증 티켓에 대 한</span><span class="sxs-lookup"><span data-stu-id="d9b06-385">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="d9b06-386">사용자를 적절 한 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-386">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="d9b06-387">이러한 단계는 위의 코드에 복제 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-387">These steps are replicated in the code above.</span></span> <span data-ttu-id="d9b06-388">첫째, 결국 UserData 속성에 저장할 문자열 회사 이름 및 두 개의 값을 파이프 문자 (|)과 구분 하는 제목, 결합 하 여 형성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-388">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="d9b06-389">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span><span class="sxs-lookup"><span data-stu-id="d9b06-389">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="d9b06-390">다음으로, 인증 티켓을 만드는, FormsAuthentication.GetAuthCookie 메서드가 호출 되는 암호화 및 구성 설정에 따라 유효성 검사를 수행 하 고 HttpCookie 개체에 배치 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-390">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="d9b06-391">AuthCookie로 HttpCookie dim FormsAuthentication.GetAuthCookie (UserName.Text, RememberMe.Checked) =</span><span class="sxs-lookup"><span data-stu-id="d9b06-391">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="d9b06-392">쿠키 내에 포함 된 FormAuthenticationTicket를 사용 하려면 FormAuthentication 클래스를 호출 해야 [메서드 해독](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.decrypt.aspx)쿠키 값에 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-392">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="d9b06-393">티켓으로 FormsAuthenticationTicket dim FormsAuthentication.Decrypt(authCookie.Value) =</span><span class="sxs-lookup"><span data-stu-id="d9b06-393">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="d9b06-394">그런 다음 만듭니다는 *새* FormsAuthenticationTicket 인스턴스 값을 기반으로 기존 FormsAuthenticationTicket의 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-394">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="d9b06-395">그러나이 새 티켓 사용자 관련 정보 (userDataString)에 포함 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-395">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="d9b06-396">NewTicket으로 FormsAuthenticationTicket dim 새 FormsAuthenticationTicket(ticket. = 버전 티켓입니다. 이름, 티켓입니다. IssueDate, 티켓입니다. 티켓 만료 합니다. IsPersistent userDataString)</span><span class="sxs-lookup"><span data-stu-id="d9b06-396">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="d9b06-397">에서는 다음 암호화 (및 유효성 검사)를 호출 하 여 새 FormsAuthenticationTicket 인스턴스는 [메서드 암호화](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.encrypt.aspx), 하며 authCookie에이 암호화 된 (및 유효성이 검사 된) 데이터를 다시 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-397">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="d9b06-398">authCookie.Value FormsAuthentication.Encrypt(newTicket) =</span><span class="sxs-lookup"><span data-stu-id="d9b06-398">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="d9b06-399">마지막으로 authCookie 미리 컬렉션에 추가 되 고 GetRedirectUrl 메서드 호출 되어 사용자에 게 보낼를 적절 한 페이지 확인.</span><span class="sxs-lookup"><span data-stu-id="d9b06-399">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="d9b06-400">이 코드의 모든 UserData 속성은 읽기 전용 이며 FormsAuthentication 클래스가 GetAuthCookie, SetAuthCookie, 또는 RedirectFromLoginPage 메서드에서 사용자 데이터 정보를 지정 하는 메서드를 제공 하지 않는 때문에 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-400">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-401">쿠키 기반 인증 티켓의 사용자 관련 정보를 저장 하는 코드 검사 했습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-401">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="d9b06-402">폼 인증 티켓을 URL로 직렬화 하는 작업을 담당 클래스는.NET Framework에 대 한 내부입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-402">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="d9b06-403">말해서, 쿠키 없는 폼 인증 티켓의 사용자 데이터를 저장할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-403">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="d9b06-404">사용자 데이터 정보에 액세스</span><span class="sxs-lookup"><span data-stu-id="d9b06-404">Accessing the UserData Information</span></span>

<span data-ttu-id="d9b06-405">이 시점에서 각 사용자의 회사 이름과 title 속성에 저장 됩니다 폼 인증 티켓 UserData 로그인 할 때입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-405">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="d9b06-406">사용자 저장소에 이동 하지 않고도이 정보를 모든 페이지에서 인증 티켓에서 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-406">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="d9b06-407">을 설명 하기 위해 UserData 속성에서이 정보를 검색할 수 있는 방법을 환영 메시지 뿐 아니라 사용자의 이름, 포함 하지만 또한에 대해 작동 하는 회사 제목에 Default.aspx를 업데이트 해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-407">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="d9b06-408">현재 Default.aspx 라는 WelcomeBackMessage 레이블 컨트롤과 AuthenticatedMessagePanel 패널을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-408">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="d9b06-409">이 패널은 인증 된 사용자에 게 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-409">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="d9b06-410">Default.aspx의 페이지에서 코드를 업데이트\_을 다음과 같이 이벤트 처리기를 로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-410">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="d9b06-411">Request.IsAuthenticated가 True 인 경우 WelcomeBackMessage의 Text 속성은 먼저 시작 뒤로 설정 *username*합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-411">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="d9b06-412">그런 다음 기본 FormsAuthenticationTicket 액세스할 수 있도록 User.Identity 속성 FormsIdentity 개체 캐스팅 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-412">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="d9b06-413">FormsAuthenticationTicket 있으면, 회사 이름 및 제목으로 UserData 속성을 역직렬화 우리 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-413">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="d9b06-414">이 항목은 파이프 문자에서 문자열을 분할 하 여 수행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-414">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="d9b06-415">그러면 회사 이름 및 제목이 WelcomeBackMessage 레이블에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-415">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="d9b06-416">그림 5에는 실행에서이 디스플레이의 스크린샷을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-416">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="d9b06-417">Scott로 로그인 Scott의 회사 및 제목을 포함 하는 환영 백 메시지를 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-417">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="d9b06-418">[![현재 로그온 한 사용자의 회사 및 제목 표시](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-418">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="d9b06-419">**그림 05**: The 현재 로그온 한 사용자의 회사 및 제목 표시 됩니다 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-419">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d9b06-420">인증 티켓 UserData 속성 사용자 저장소에 대 한 캐시 역할을 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-420">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="d9b06-421">모든 캐시와 같은 기본 데이터가 수정 될 때 업데이트 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-421">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="d9b06-422">예를 들어 사용자가 자신의 프로필을 업데이트할 수 있는 웹 페이지 이면 UserData 속성에 캐시 필드 사용자가 수행한 변경 내용을 반영 하도록 새로 고쳐야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-422">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="d9b06-423">5 단계: 사용자 지정 보안 주체를 사용 하 여</span><span class="sxs-lookup"><span data-stu-id="d9b06-423">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="d9b06-424">들어오는 각 요청은 FormsAuthenticationModule 사용자 인증을 시도 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-424">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="d9b06-425">만료 되지 않은 인증 티켓이 있는 경우는 FormsAuthenticationModule HttpContext.User 속성 새 GenericPrincipal 개체에 할당 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-425">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="d9b06-426">이 GenericPrincipal 개체에 FormsIdentity 폼 인증 티켓에 대 한 참조를 포함 하는 유형의 Id입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-426">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="d9b06-427">IPrincipal 구현 하는 클래스에 필요한 최소 운영 체제 미 설치 기능을 포함 하는 GenericPrincipal 클래스-IsInRole 방법과 Identity 속성에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-427">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="d9b06-428">주요 개체는 두 가지가: 사용자가 속한 역할을 지정 하 고 id 정보를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-428">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="d9b06-429">시키는 방법을 IPrincipal 인터페이스 IsInRole (*roleName*) 메서드와 Identity 속성을 각각.</span><span class="sxs-lookup"><span data-stu-id="d9b06-429">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="d9b06-430">GenericPrincipal 클래스를 해당 생성자;를 통해 지정 해야 역할 이름의 문자열 배열에 대 한 허용 합니다. 해당 IsInRole (*roleName*) 검사 있는지 전달 된에서 *roleName* 문자열 배열 내에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-430">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="d9b06-431">FormsAuthenticationModule 만듭니다는 GenericPrincipal, 빈 문자열 배열을 GenericPrincipal의 생성자에 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-431">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="d9b06-432">따라서 IsInRole 호출할 때 항상 False를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-432">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="d9b06-433">GenericPrincipal 클래스에는 역할이 사용 되지 않습니다는 대부분의 양식 기반된 인증 시나리오에 대 한 요구 사항을 충족 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-433">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="d9b06-434">기본 역할 처리 충분 하지 않은 경우를 위해 있고 사용자 지정 IIdentity 개체를 사용자와 연결 해야 할 때 인증 워크플로 중 사용자 지정 IPrincipal 개체를 만들 HttpContext.User 속성에 할당 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-434">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-435">자습서, 나중에 알 수 있듯이 때 ASP 합니다. NET의 역할 프레임 워크가 활성화 형식의 사용자 지정 보안 주체 개체를 만듭니다 [RolePrincipal](https://msdn.microsoft.com/en-us/library/system.web.security.roleprincipal.aspx) 폼 인증에서 만든 GenericPrincipal 개체를 덮어씁니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-435">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/en-us/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="d9b06-436">역할 프레임 워크의 API와 상호 작용 하는 보안 주체의 IsInRole 메서드를 사용자 지정 하기 위해 수행 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-436">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="d9b06-437">우리는 신경 쓰지 직접 역할 아직, 이후 시점에 사용자 지정 보안 주체를 만들기 위한 있다고 하는 유일한 이유는 보안 주체에는 사용자 지정 IIdentity 개체에 연결할 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-437">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="d9b06-438">4 단계에서에서 사용자의 회사 이름과 직책이 특히에서 인증 티켓 UserData 속성에 추가 사용자 정보를 저장 살펴보았습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-438">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="d9b06-439">그러나 UserData 정보를만 인증 티켓을 통해 액세스할 수만 다음 serialize 된 문자열로 서, 티켓에 저장 된 사용자 정보를 보려면 원하는 언제 든 지 해야 한다는 사실을 UserData 속성을 구문 분석을 의미 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-439">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="d9b06-440">IIdentity를 구현 하 고 CompanyName 및 제목 속성을 포함 하는 클래스를 만들어 개발자 환경을 개선할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-440">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="d9b06-441">이런 방식으로 개발자 현재 로그온된 한 사용자의 회사 이름에 액세스할 수 및 없이 CompanyName 및 Title 속성을 통해 직접 제목 필요한 UserData 속성을 구문 분석 하는 방법에 알아야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-441">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="d9b06-442">사용자 지정 Id 및 주 클래스 만들기</span><span class="sxs-lookup"><span data-stu-id="d9b06-442">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="d9b06-443">이 자습서에 대 한 만들기는 사용자 지정 보안 주체 개체 및 identity 개체 응용 프로그램에서\_코드 폴더입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-443">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="d9b06-444">응용 프로그램을 추가 하 여 시작\_폴더를 프로젝트 코드-솔루션 탐색기에서 프로젝트 이름을 마우스 오른쪽 단추로 클릭 하 고, ASP.NET 폴더 추가 옵션을 선택 하 고 응용 프로그램을 선택\_코드입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-444">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="d9b06-445">응용 프로그램\_코드 폴더는 웹 사이트에 특정 클래스 파일을 보유 하는 특별 한 ASP.NET 폴더입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-445">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="d9b06-446">응용 프로그램\_코드 폴더를 통해 웹 사이트 프로젝트 모델 프로젝트를 관리 하는 경우에 사용 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-446">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="d9b06-447">사용 하는 경우는 [웹 응용 프로그램 프로젝트 모델](https://msdn.microsoft.com/en-us/asp.net/Aa336618.aspx), 표준 폴더를 만들고 있는 클래스에 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-447">If you are using the [Web Application Project Model](https://msdn.microsoft.com/en-us/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="d9b06-448">예를 들어, 클래스, 라는 새 폴더를 추가 하 고 코드에 놓일 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-448">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="d9b06-449">다음으로 응용 프로그램에 새 클래스 파일을 두 개를 추가\_코드 폴더, 하나의 명명 된 CustomIdentity.vb 개와 라는 CustomPrincipal.vb 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-449">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>


<span data-ttu-id="d9b06-450">[![프로젝트에 CustomIdentity와 CustomPrincipal 클래스 추가](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-450">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="d9b06-451">**그림 06**: CustomIdentity와 CustomPrincipal 클래스를 프로젝트에 추가 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-451">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>


<span data-ttu-id="d9b06-452">CustomIdentity 클래스는 AuthenticationType, IsAuthenticated, 및 이름 속성을 정의 하는 IIdentity 인터페이스를 구현 하는 일을 담당 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-452">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="d9b06-453">이 이러한 필수 속성 외에도 연습에서는 기본 폼 인증 티켓으로 사용자의 회사 이름과 제목에 대 한 속성을 노출 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-453">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="d9b06-454">CustomIdentity 클래스에 다음 코드를 입력 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-454">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="d9b06-455">클래스 FormsAuthenticationTicket 멤버 변수를 포함 하는 참고 (\_티켓) 생성자를 통해이 티켓 정보를 제공 해야 하 고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-455">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="d9b06-456">이 티켓 데이터 반환 하므로 id의 Name;에 사용 됩니다. CompanyName 및 Title 속성에 대 한 값을 반환 하 고 UserData 속성 구문 분석 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-456">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="d9b06-457">다음으로 CustomPrincipal 클래스를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-457">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="d9b06-458">CustomPrincipal 클래스의 생성자가 CustomIdentity 개체만; 허용 것은 문제가 되지 않습니다 역할 시점, 이후 IsInRole 메서드는 항상 False를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-458">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="d9b06-459">들어오는 요청의 보안 컨텍스트 CustomPrincipal 개체 할당</span><span class="sxs-lookup"><span data-stu-id="d9b06-459">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="d9b06-460">했습니다 CompanyName 및 제목 속성을 포함 하도록 기본 IIdentity 사양을 확장 하는 클래스 뿐만 아니라 사용자 지정 id를 사용 하는 사용자 지정 주 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-460">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="d9b06-461">ASP.NET 파이프라인에 단계를 준비 하 고 수신 요청의 보안 컨텍스트를이 사용자 지정 보안 주체 개체를 할당 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-461">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="d9b06-462">ASP.NET 파이프라인 들어오는 요청을 사용 하 고 몇 가지 단계를 통해 처리 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-462">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="d9b06-463">각 단계에서 특정 이벤트 발생 ASP.NET 파이프라인에 간단 하 고 해당 수명 주기 전체에서 특정 시점에서 요청을 수정 하는 개발자를 위한 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-463">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="d9b06-464">FormsAuthenticationModule 시키려면 ASP.NET에 대 한 예를 들어 대기는 [AuthenticateRequest 이벤트](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx), 어느 지점에서 인증 티켓에 대 한 들어오는 요청 검사 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-464">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="d9b06-465">인증 티켓 있더라도 GenericPrincipal 개체가 생성 되 고 HttpContext.User 속성에 할당 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-465">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="d9b06-466">ASP.NET 파이프라인 AuthenticateRequest 이벤트를 발생 시킵니다는 [PostAuthenticateRequest 이벤트](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.postauthenticaterequest.aspx)역할의 인스턴스와 FormsAuthenticationModule에서 만든 GenericPrincipal 개체를 바꿀 수 있습니다는 우리의 CustomPrincipal 개체입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-466">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="d9b06-467">그림 7이이 워크플로 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-467">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="d9b06-468">[![GenericPrincipal PostAuthenticationRequest 이벤트에서 CustomPrincipal으로 대체 됩니다.](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-468">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="d9b06-469">**그림 07**: The GenericPrincipal PostAuthenticationRequest 이벤트에서 CustomPrincipal으로 대체 됩니다 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-469">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>


<span data-ttu-id="d9b06-470">를 ASP.NET 파이프라인 이벤트에 대 한 응답에서 코드를 실행 하기 위해 म Global.asax에 적절 한 이벤트 처리기를 만들고 하거나 고유한 HTTP 모듈을 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-470">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="d9b06-471">이 자습서에 대 한 Global.asax에 이벤트 처리기를 만들어 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-471">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="d9b06-472">먼저 Global.asax 웹 사이트에 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-472">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="d9b06-473">솔루션 탐색기에서 프로젝트 이름을 마우스 Global.asax 라는 전역 응용 프로그램 클래스 형식의 항목을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-473">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="d9b06-474">[![Global.asax 파일을 웹 사이트 추가](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="d9b06-474">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="d9b06-475">**그림 08**: Global.asax 파일을 웹 사이트 추가 ([전체 크기 이미지를 보려면 클릭](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d9b06-475">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>


<span data-ttu-id="d9b06-476">시작, 끝을 포함 하 여 ASP.NET 파이프라인 이벤트 수에 대 한 이벤트 처리기를 포함 하는 기본 Global.asax 서식 파일 및 [오류 이벤트](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx), 등입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-476">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="d9b06-477">자유롭게에이 응용 프로그램에 필요 하지 않은 것 처럼 이러한 이벤트 처리기를 제거 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-477">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="d9b06-478">이 연습 이벤트 PostAuthenticateRequest입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-478">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="d9b06-479">해당 태그와 다음과 유사 하므로 Global.asax 파일을 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-479">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="d9b06-480">응용 프로그램\_OnPostAuthenticateRequest 메서드가 실행 될 때마다 ASP.NET 런타임이 들어오는 각 페이지 요청에서 한 번 수행 PostAuthenticateRequest 이벤트를 발생 시킵니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-480">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="d9b06-481">이벤트 처리기를 확인 하는 사용자가 인증 한 폼 인증을 통해 인증 되 고 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-481">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="d9b06-482">이 경우에 새 CustomIdentity 개체가 생성 되 고 현재 요청 인증 티켓의 생성자에 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-482">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="d9b06-483">그런 다음, CustomPrincipal 개체를 만들고 CustomIdentity 방금 만든 개체의 생성자에 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-483">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="d9b06-484">마지막으로, 현재 요청의 보안 컨텍스트는 새로 만든된 CustomPrincipal 개체에 할당 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-484">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="d9b06-485">-요청의 보안 컨텍스트를 CustomPrincipal 개체 연결-마지막 단계는 두 개의 속성에 보안 주체를 매기는 참고: HttpContext.User 및 Thread.CurrentPrincipal 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-485">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="d9b06-486">이러한 두 할당은 ASP.NET에서 처리 되는 보안 컨텍스트는 방식 때문에 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-486">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="d9b06-487">.NET Framework 보안 컨텍스트는 각 실행 스레드;에 연결 이 정보를 통해 IPrincipal 개체로 사용할 수는 [스레드 개체](https://msdn.microsoft.com/en-us/library/system.threading.thread.aspx)의 [CurrentPrincipal 속성](https://msdn.microsoft.com/en-us/library/system.threading.thread.currentcontext.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-487">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/en-us/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/en-us/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="d9b06-488">혼란 스 러는 ASP.NET에는 자체 보안 컨텍스트 정보 (HttpContext.User)입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-488">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="d9b06-489">특정 시나리오에서 Thread.CurrentPrincipal 속성을 보안 컨텍스트를 결정할 때 검사 다른 시나리오에서는 HttpContext.User 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-489">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="d9b06-490">예를 들어 사용자가 선언적으로 지정할 수 있는 보안 기능이.net에서 또는 역할 클래스를 인스턴스화할 수 특정 메서드를 호출 하거나 (참조 [업무 및 사용 하 여 데이터 계층에 권한 부여 규칙 추가 PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="d9b06-490">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="d9b06-491">다음과 같은 선언적 방법을 내부적 Thread.CurrentPrincipal 속성을 통해 보안 컨텍스트를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-491">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="d9b06-492">다른 시나리오에서는 HttpContext.User 속성이 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-492">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="d9b06-493">예를 들어 이전 자습서에서 사용이 속성에서 현재 로그온 된 사용자의 사용자 이름을 표시 하려면.</span><span class="sxs-lookup"><span data-stu-id="d9b06-493">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="d9b06-494">명확 하 게 하는 것이 보안 컨텍스트 정보 Thread.CurrentPrincipal 및 HttpContext.User 속성에 맞춰 명령입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-494">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="d9b06-495">ASP.NET 런타임 us에 대 한 이러한 속성 값을 자동으로 동기화 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-495">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="d9b06-496">그러나이 동기화 AuthenticateRequest 이벤트 후에 발생 하지만 *전에* PostAuthenticateRequest 이벤트입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-496">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="d9b06-497">따라서 PostAuthenticateRequest 이벤트에 사용자 지정 보안 주체를 추가 하는 경우 반드시 수동으로 Thread.CurrentPrincipal 또는 else Thread.CurrentPrincipal을 할당 해야 하 고 HttpContext.User 동기화 됩니다. 참조 [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) 에 대 한 자세한 내용은이 문제입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-497">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="d9b06-498">CompanyName 및 제목 속성에 액세스</span><span class="sxs-lookup"><span data-stu-id="d9b06-498">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="d9b06-499">요청이 도착 하 고 ASP.NET 엔진 응용 프로그램에 디스패치할 때마다\_Global.asax에 OnPostAuthenticateRequest 이벤트 처리기는 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-499">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="d9b06-500">요청은 FormsAuthenticationModule 하 여 인증 되 면 이벤트 처리기는 폼 인증 티켓을 기반으로 하는 CustomIdentity 개체와 새 CustomPrincipal 개체를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-500">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="d9b06-501">위치에이 논리를 사용 하 여 현재 로그온된 한 사용자의 회사 이름과 제목에 대 한 정보에 액세스 하는 매우 간단 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-501">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="d9b06-502">페이지로 돌아가\_Default.aspx, 여기서 4 단계에서에서 안내 드린 바 폼 인증 티켓을 검색 한 사용자의 회사 이름 및 제목 표시 하기 위해 UserData 속성을 구문 분석 하는 코드에서에서 이벤트 처리기를 로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-502">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="d9b06-503">사용 이제 CustomPrincipal 및 CustomIdentity 개체와 티켓의 UserData 속성에서 값을 구문 분석 하지 않아도가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-503">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="d9b06-504">대신, 단순히 CustomIdentity 개체에 대 한 참조를 가져오고 CompanyName 및 제목 속성을 사용 하 여:</span><span class="sxs-lookup"><span data-stu-id="d9b06-504">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="d9b06-505">요약</span><span class="sxs-lookup"><span data-stu-id="d9b06-505">Summary</span></span>

<span data-ttu-id="d9b06-506">이 자습서에서 Web.config 통해 폼 인증 시스템 설정을 사용자 지정 하는 방법을 검사 했습니다. 인증 티켓이 만료를 처리 하는 방법을 고 검사 및 수정 된 티켓을 방지 하기 위해 암호화 및 유효성 검사 보호 기능을 사용 하는 방법 살펴보았습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-506">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="d9b06-507">마지막으로 인증 티켓 UserData 속성을 사용 하 여 자체 티켓의 추가 사용자 정보와 사용자 지정 보안 주체 및 identity 개체를 사용 하 여 더 개발자에 게 친숙 한 방식으로이 정보를 노출 하는 방법을 저장 하 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-507">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="d9b06-508">이 자습서는 asp.net에서 폼 인증 검사를 완료 했습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-508">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="d9b06-509">다음 자습서 구성원 프레임 워크에이 작업을 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-509">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="d9b06-510">만족도 매우 프로그래밍!</span><span class="sxs-lookup"><span data-stu-id="d9b06-510">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d9b06-511">추가 정보</span><span class="sxs-lookup"><span data-stu-id="d9b06-511">Further Reading</span></span>

<span data-ttu-id="d9b06-512">이 자습서에 설명 된 항목에 대 한 자세한 내용은 다음 리소스를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="d9b06-512">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d9b06-513">폼 인증 나누어서</span><span class="sxs-lookup"><span data-stu-id="d9b06-513">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="d9b06-514">ASP.NET 2.0에서에서 폼 인증 설명이 나와 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-514">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/en-us/library/aa480476.aspx)
- [<span data-ttu-id="d9b06-515">방법: ASP.NET 2.0에서에서 폼 인증을 보호</span><span class="sxs-lookup"><span data-stu-id="d9b06-515">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/en-us/library/ms998310.aspx)
- <span data-ttu-id="d9b06-516">[전문 ASP.NET 2.0 보안, 구성원 자격 및 역할 관리](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="d9b06-516">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="d9b06-517">로그인 컨트롤 보안</span><span class="sxs-lookup"><span data-stu-id="d9b06-517">Securing Login Controls</span></span>](https://msdn.microsoft.com/en-us/library/ms178346.aspx)
- [<span data-ttu-id="d9b06-518">&lt;인증&gt; 요소</span><span class="sxs-lookup"><span data-stu-id="d9b06-518">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/en-us/library/532aee0e.aspx)
- [<span data-ttu-id="d9b06-519">&lt;forms&gt; 요소에 대 한 &lt;인증&gt;</span><span class="sxs-lookup"><span data-stu-id="d9b06-519">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/en-us/library/1d3t3c61.aspx)
- [<span data-ttu-id="d9b06-520">&lt;machineKey&gt; 요소</span><span class="sxs-lookup"><span data-stu-id="d9b06-520">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/en-us/library/w8h3skw9.aspx)
- [<span data-ttu-id="d9b06-521">폼 인증 티켓 및 쿠키 이해</span><span class="sxs-lookup"><span data-stu-id="d9b06-521">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="d9b06-522">이 자습서에 포함 된 항목에 대 한 비디오 교육</span><span class="sxs-lookup"><span data-stu-id="d9b06-522">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="d9b06-523">폼 인증 속성을 변경 하는 방법</span><span class="sxs-lookup"><span data-stu-id="d9b06-523">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="d9b06-524">ASP.NET 응용 프로그램에서 쿠키 없는 인증을 설정 및 사용 하는 방법</span><span class="sxs-lookup"><span data-stu-id="d9b06-524">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="d9b06-525">ASP Forms 로그인 재배치</span><span class="sxs-lookup"><span data-stu-id="d9b06-525">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="d9b06-526">양식 로그인 사용자 지정 키 구성</span><span class="sxs-lookup"><span data-stu-id="d9b06-526">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="d9b06-527">인증 방법에 사용자 지정 데이터 추가</span><span class="sxs-lookup"><span data-stu-id="d9b06-527">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="d9b06-528">사용 하 여 사용자 지정 보안 주체 개체</span><span class="sxs-lookup"><span data-stu-id="d9b06-528">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="d9b06-529">작성자 정보</span><span class="sxs-lookup"><span data-stu-id="d9b06-529">About the Author</span></span>

<span data-ttu-id="d9b06-530">여러 ASP/ASP.NET 책의 작성자 및 4GuysFromRolla.com의 창립자 Scott Mitchell의 근무 기간이 Microsoft 웹 기술을 1998 이후입니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-530">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d9b06-531">Scott 독립 컨설턴트, 강사, 기술 및 작성기 작동합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-531">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d9b06-532">그의 최신 서적은  *[Sam 업무량이 직접 ASP.NET 2.0 24 시간 동안에서](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-532">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="d9b06-533">Scott에 도달할 수 [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) 또는에서 그의 블로그 통해 [http://ScottOnWriting.NET](http://scottonwriting.net/)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-533">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="d9b06-534">특별히 감사</span><span class="sxs-lookup"><span data-stu-id="d9b06-534">Special Thanks To</span></span>

<span data-ttu-id="d9b06-535">이 자습서 시리즈 많은 유용한 검토자가 검토 합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-535">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d9b06-536">이 자습서에 대 한 선행 검토자 Alicja Maziarz 했습니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-536">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="d9b06-537">향후 내 MSDN 문서를 검토에 관심이 있으십니까?</span><span class="sxs-lookup"><span data-stu-id="d9b06-537">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d9b06-538">이 경우 drop me에 한 줄씩 [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com)합니다.</span><span class="sxs-lookup"><span data-stu-id="d9b06-538">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="d9b06-539">이전</span><span class="sxs-lookup"><span data-stu-id="d9b06-539">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
