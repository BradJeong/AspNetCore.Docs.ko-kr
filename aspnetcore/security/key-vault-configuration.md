---
title: "Azure 키 자격 증명 모음 구성 공급자"
author: guardrex
description: "Azure 키 자격 증명 모음 구성 공급자를 사용 하 여 런타임에 로드 하는 이름-값 쌍을 사용 하 여 응용 프로그램을 구성 하는 방법에 알아봅니다."
keywords: "ASP.NET Core, 구성, Azure 주요 자격 증명 모음"
ms.author: riande
manager: wpickett
ms.date: 08/09/2017
ms.topic: article
ms.assetid: 0292bdae-b3ed-4637-bd67-19b9bb8b65cb
ms.prod: asp.net-core
uid: security/key-vault-configuration
ms.openlocfilehash: 2c94daafec8d3b4051bd3091478521ab12a434bd
ms.sourcegitcommit: 78d28178345a0eea91556e4cd1adad98b1446db8
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 09/22/2017
---
# <a name="azure-key-vault-configuration-provider"></a><span data-ttu-id="34e49-104">Azure 키 자격 증명 모음 구성 공급자</span><span class="sxs-lookup"><span data-stu-id="34e49-104">Azure Key Vault configuration provider</span></span>

<span data-ttu-id="34e49-105">여 [Luke Latham](https://github.com/GuardRex) 및 [Andrew Stanton 간호사](https://github.com/anurse)</span><span class="sxs-lookup"><span data-stu-id="34e49-105">By [Luke Latham](https://github.com/GuardRex) and [Andrew Stanton-Nurse](https://github.com/anurse)</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="34e49-106">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="34e49-106">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="34e49-107">보기 또는 2.x에 대 한 샘플 코드를 다운로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-107">View or download sample code for 2.x:</span></span>

* <span data-ttu-id="34e49-108">[기본 샘플](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/2.x) -는 응용 프로그램에 보안 값을 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-108">[Basic sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/2.x) - Reads secret values into an app.</span></span>
* <span data-ttu-id="34e49-109">[키 이름 접두사 샘플](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/2.x) -서로 다른 각 응용 프로그램 버전에 대 한 비밀 값 집합을 로드할 수 있는 응용 프로그램의 버전을 나타내는 키 이름 접두사를 사용 하 여 읽기 비밀 값입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-109">[Key name prefix sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/2.x) - Reads secret values using a key name prefix that represents the version of an app, which allows you to load a different set of secret values for each app version.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="34e49-110">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="34e49-110">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="34e49-111">보기 또는 1.x에 대 한 샘플 코드를 다운로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-111">View or download sample code for 1.x:</span></span>

* <span data-ttu-id="34e49-112">[기본 샘플](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x) -는 응용 프로그램에 보안 값을 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-112">[Basic sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x) - Reads secret values into an app.</span></span>
* <span data-ttu-id="34e49-113">[키 이름 접두사 샘플](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/1.x) -서로 다른 각 응용 프로그램 버전에 대 한 비밀 값 집합을 로드할 수 있는 응용 프로그램의 버전을 나타내는 키 이름 접두사를 사용 하 여 읽기 비밀 값입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-113">[Key name prefix sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/1.x) - Reads secret values using a key name prefix that represents the version of an app, which allows you to load a different set of secret values for each app version.</span></span> 

---

<span data-ttu-id="34e49-114">이 문서에서는 사용 하는 방법에 설명 된 [Microsoft Azure Key Vault](https://azure.microsoft.com/services/key-vault/) 구성 공급자를 Azure 키 자격 증명 모음 암호에서 응용 프로그램 구성 값을 로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-114">This document explains how to use the [Microsoft Azure Key Vault](https://azure.microsoft.com/services/key-vault/) configuration provider to load application configuration values from Azure Key Vault secrets.</span></span> <span data-ttu-id="34e49-115">Azure 키 자격 증명 모음에는 암호화 키와 앱 및 서비스에서 사용 하는 암호를 보호 하는 데 도움이 되는 클라우드 기반 서비스입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-115">Azure Key Vault is a cloud-based service that helps you safeguard cryptographic keys and secrets used by apps and services.</span></span> <span data-ttu-id="34e49-116">일반적인 시나리오는 중요 한 구성 데이터에 대 한 액세스 제어를 포함 하며 FIPS 140-2에 대 한 요구 사항을 충족 수준 2 하드웨어 보안 모듈 (HSM의) 될 때 확인 구성 데이터를 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-116">Common scenarios include controlling access to sensitive configuration data and meeting the requirement for FIPS 140-2 Level 2 validated Hardware Security Modules (HSM's) when storing configuration data.</span></span> <span data-ttu-id="34e49-117">이 기능은 이상의 ASP.NET Core 1.1을 대상으로 하는 응용 프로그램에 대해 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-117">This feature is available for applications that target ASP.NET Core 1.1 or higher.</span></span>

## <a name="package"></a><span data-ttu-id="34e49-118">패키지</span><span class="sxs-lookup"><span data-stu-id="34e49-118">Package</span></span>
<span data-ttu-id="34e49-119">공급자를 사용 하려면 추가에 대 한 참조는 [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) 패키지 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-119">To use the provider, add a reference to the [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) package.</span></span>

## <a name="application-configuration"></a><span data-ttu-id="34e49-120">응용 프로그램 구성</span><span class="sxs-lookup"><span data-stu-id="34e49-120">Application configuration</span></span>
<span data-ttu-id="34e49-121">사용 하 여 공급자를 탐색할 수 있습니다는 [앱 샘플](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-121">You can explore the provider with the [sample apps](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples).</span></span> <span data-ttu-id="34e49-122">주요 자격 증명 모음을 설정 하 고 자격 증명 모음에 암호를 만들 샘플 앱은 안전 하 게을 로드 하는 비밀 값 해당 구성에 웹 페이지에 표시할.</span><span class="sxs-lookup"><span data-stu-id="34e49-122">Once you establish a key vault and create secrets in the vault, the sample apps securely load the secret values into their configurations and display them in webpages.</span></span>

<span data-ttu-id="34e49-123">공급자에 추가 되는 `ConfigurationBuilder` 와 `AddAzureKeyVault` 확장 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-123">The provider is added to the `ConfigurationBuilder` with the `AddAzureKeyVault` extension.</span></span> <span data-ttu-id="34e49-124">샘플 응용 프로그램에서 확장 프로그램은 사용에서 로드 된 세 가지 구성 값은 *appsettings.json* 파일입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-124">In the sample apps, the extension uses three configuration values loaded from the *appsettings.json* file.</span></span>

| <span data-ttu-id="34e49-125">앱 설정</span><span class="sxs-lookup"><span data-stu-id="34e49-125">App Setting</span></span>    | <span data-ttu-id="34e49-126">설명</span><span class="sxs-lookup"><span data-stu-id="34e49-126">Description</span></span>                    | <span data-ttu-id="34e49-127">예제</span><span class="sxs-lookup"><span data-stu-id="34e49-127">Example</span></span>                                      |
| -------------- | ------------------------------ | -------------------------------------------- |
| `Vault`        | <span data-ttu-id="34e49-128">Azure 키 자격 증명 모음 이름</span><span class="sxs-lookup"><span data-stu-id="34e49-128">Azure Key Vault name</span></span>           | <span data-ttu-id="34e49-129">contosovault</span><span class="sxs-lookup"><span data-stu-id="34e49-129">contosovault</span></span>                                 |
| `ClientId`     | <span data-ttu-id="34e49-130">Azure Active Directory 응용 프로그램 Id</span><span class="sxs-lookup"><span data-stu-id="34e49-130">Azure Active Directory App Id</span></span>  | <span data-ttu-id="34e49-131">627e911e-43cc-61d4-992e-12db9c81b413</span><span class="sxs-lookup"><span data-stu-id="34e49-131">627e911e-43cc-61d4-992e-12db9c81b413</span></span>         |
| `ClientSecret` | <span data-ttu-id="34e49-132">Azure Active Directory 응용 프로그램 키</span><span class="sxs-lookup"><span data-stu-id="34e49-132">Azure Active Directory App Key</span></span> | <span data-ttu-id="34e49-133">g58K3dtg59o1Pa e59v2Tx829w6VxTB2yv9sv/101di + =</span><span class="sxs-lookup"><span data-stu-id="34e49-133">g58K3dtg59o1Pa+e59v2Tx829w6VxTB2yv9sv/101di=</span></span> |

[!code-csharp[Program](key-vault-configuration/samples/basic-sample/2.x/Program.cs?name=snippet1&highlight=2,7-10)]

## <a name="creating-key-vault-secrets-and-loading-configuration-values-basic-sample"></a><span data-ttu-id="34e49-134">주요 자격 증명 모음 암호 만들기 및 구성 값 (basic 샘플)를 로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-134">Creating key vault secrets and loading configuration values (basic-sample)</span></span>
1. <span data-ttu-id="34e49-135">키 자격 증명 모음 만들기 및 Azure Active Directory (Azure AD)의 지침에 따라 응용 프로그램에 대 한 설정 [Azure 키 자격 증명 모음 시작](https://azure.microsoft.com/documentation/articles/key-vault-get-started/)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-135">Create a key vault and set up Azure Active Directory (Azure AD) for the application following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
  * <span data-ttu-id="34e49-136">암호를 사용 하 여 주요 자격 증명 모음에 추가 된 [AzureRM 키 자격 증명 모음 PowerShell 모듈](/powershell/module/azurerm.keyvault) 에서 사용할 수는 [PowerShell 갤러리](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure 키 자격 증명 모음 REST API](/rest/api/keyvault/), 또는 [Azure 포털](https://portal.azure.com/)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-136">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="34e49-137">비밀 하나로 만들어집니다 *수동* 또는 *인증서* 비밀 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-137">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="34e49-138">*인증서* 비밀 앱 및 서비스에서 사용 하기 위해 인증서가 있지만 구성 공급자에서 지원 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-138">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="34e49-139">사용 해야는 *수동* 구성 공급자와 함께 사용 하기 위해 암호 이름-값 쌍을 만드는 옵션을 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-139">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
    * <span data-ttu-id="34e49-140">단순 암호 이름-값 쌍으로 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-140">Simple secrets are created as name-value pairs.</span></span> <span data-ttu-id="34e49-141">Azure 키 자격 증명 모음 보안 이름은 영숫자, 대시로 제한 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-141">Azure Key Vault secret names are limited to alphanumeric characters and dashes.</span></span>
    * <span data-ttu-id="34e49-142">계층 값 (구성 섹션) 사용 하 여 `--` (대시 두 개)이 샘플에서 구분 기호로 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-142">Hierarchical values (configuration sections) use `--` (two dashes) as a separator in the sample.</span></span> <span data-ttu-id="34e49-143">하위 키에의 한 부분을 구분 하는 데 일반적으로 사용 되는 콜론 [ASP.NET Core 구성](xref:fundamentals/configuration), 비밀 이름에 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-143">Colons, which are normally used to delimit a section from a subkey in [ASP.NET Core configuration](xref:fundamentals/configuration), aren't allowed in secret names.</span></span> <span data-ttu-id="34e49-144">따라서 대시 두 개 사용 되며 암호는 응용 프로그램의 구성에 로드 될 때 콜론으로 교체 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-144">Therefore, two dashes are used and swapped for a colon when the secrets are loaded into the app's configuration.</span></span>
    * <span data-ttu-id="34e49-145">두 개 만든 *수동* 비밀 다음 이름-값 쌍을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-145">Create two *Manual* secrets with the following name-value pairs.</span></span> <span data-ttu-id="34e49-146">첫 번째 암호는 단순한 이름 및 값, 및 두 번째 암호 섹션 및 비밀 이름에 하위 키와 비밀 값을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-146">The first secret is a simple name and value, and the second secret creates a secret value with a section and subkey in the secret name:</span></span>
      * <span data-ttu-id="34e49-147">`SecretName`: `secret_value_1`</span><span class="sxs-lookup"><span data-stu-id="34e49-147">`SecretName`: `secret_value_1`</span></span>
      * <span data-ttu-id="34e49-148">`Section--SecretName`: `secret_value_2`</span><span class="sxs-lookup"><span data-stu-id="34e49-148">`Section--SecretName`: `secret_value_2`</span></span>
  * <span data-ttu-id="34e49-149">Azure Active Directory와 샘플 응용 프로그램을 등록 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-149">Register the sample app with Azure Active Directory.</span></span>
  * <span data-ttu-id="34e49-150">응용 프로그램에서 주요 자격 증명 모음에 액세스 권한을 부여 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-150">Authorize the app to access the key vault.</span></span> <span data-ttu-id="34e49-151">사용 하는 경우는 `Set-AzureRmKeyVaultAccessPolicy` 앱 키 자격 증명 모음에 액세스할 수 권한을 부여 하는 PowerShell cmdlet을 제공 `List` 및 `Get` 와 비밀 정보에 대 한 액세스 `-PermissionsToKeys list,get`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-151">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToKeys list,get`.</span></span>
2. <span data-ttu-id="34e49-152">응용 프로그램의 업데이트 *appsettings.json* 파일의 값을 가진 `Vault`, `ClientId`, 및 `ClientSecret`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-152">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="34e49-153">구성 값을 가져오는 샘플 응용 프로그램을 실행 `IConfigurationRoot` 비밀 이름으로 같은 이름의 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-153">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the secret name.</span></span>
  * <span data-ttu-id="34e49-154">비 계층 값: 값에 대 한 `SecretName` 사용 하 여 얻은 `config["SecretName"]`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-154">Non-hierarchical values: The value for `SecretName` is obtained with `config["SecretName"]`.</span></span>
  * <span data-ttu-id="34e49-155">계층 값 (섹션): 사용 `:` (콜론) 표기법 또는 `GetSection` 확장 메서드.</span><span class="sxs-lookup"><span data-stu-id="34e49-155">Hierarchical values (sections): Use `:` (colon) notation or the `GetSection` extension method.</span></span> <span data-ttu-id="34e49-156">이러한 방법 중 하나를 사용 하 여 구성 값을 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-156">Use either of these approaches to obtain the configuration value:</span></span>
    * `config["Section:SecretName"]`
    * `config.GetSection("Section")["SecretName"]`

<span data-ttu-id="34e49-157">응용 프로그램을 실행 하면 웹 페이지 로드 된 비밀 값으로 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-157">When you run the app, a webpage shows the loaded secret values:</span></span>

![브라우저 창에는 Azure 키 자격 증명 모음 구성 공급자를 통해 로드 하는 비밀 값 표시](key-vault-configuration/_static/sample1.png)

## <a name="creating-prefixed-key-vault-secrets-and-loading-configuration-values-key-name-prefix-sample"></a><span data-ttu-id="34e49-159">접두사가 지정 된 키 자격 증명 모음 암호 만들기 및 구성 값 (키-이름-접두사-샘플)를 로드 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-159">Creating prefixed key vault secrets and loading configuration values (key-name-prefix-sample)</span></span>
<span data-ttu-id="34e49-160">`AddAzureKeyVault`또한 구현을 허용 하는 오버 로드를 제공 `IKeyVaultSecretManager`, 구성 키로 변환 하는 주요 자격 증명 모음 암호를 제어할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-160">`AddAzureKeyVault` also provides an overload that accepts an implementation of `IKeyVaultSecretManager`, which allows you to control how key vault secrets are converted into configuration keys.</span></span> <span data-ttu-id="34e49-161">예를 들어 앱을 시작할 때 제공 되는 접두사 값에 따라 보안 값을 로드 하는 인터페이스를 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-161">For example, you can implement the interface to load secret values based on a prefix value you provide at app startup.</span></span> <span data-ttu-id="34e49-162">이렇게 하면 응용 프로그램의 버전에 따라 암호를 로드 예를 들어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-162">This allows you, for example, to load secrets based on the version of the app.</span></span>

> [!WARNING]
> <span data-ttu-id="34e49-163">같은 키 자격 증명 모음에 여러 앱에 대 한 암호를 배치 하려면 또는 환경 비밀을 주요 자격 증명 모음 암호에 접두사를 사용 하지 않습니다 (예를 들어 *개발* verus *프로덕션* 비밀)를 동일한 자격 증명 모음입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-163">Don't use prefixes on key vault secrets to place secrets for multiple apps into the same key vault or to place environmental secrets (for example, *development* verus *production* secrets) into the same vault.</span></span> <span data-ttu-id="34e49-164">다른 앱과 개발/프로덕션 환경 가장 높은 보안 수준에 대 한 응용 프로그램 환경을 격리할 때 별도 주요 자격 증명 모음 사용 하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-164">We recommend that different apps and development/production environments use separate key vaults to isolate app environments for the highest level of security.</span></span>

<span data-ttu-id="34e49-165">두 번째 샘플 응용 프로그램을 사용 하면 만들 되는 암호에 대 한 주요 자격 증명 모음에 `5000-AppSecret` (마침표 비밀 키 자격 증명 모음 이름에 허용 되지) 5.0.0.0 응용 프로그램의 버전에 대 한 앱 암호를 나타내는입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-165">Using the second sample app, you create a secret in the key vault for `5000-AppSecret` (periods aren't allowed in key vault secret names) representing an app secret for version 5.0.0.0 of your app.</span></span> <span data-ttu-id="34e49-166">에 대 한 암호를 만들면 다른 버전의 경우, 5.1.0.0 `5100-AppSecret`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-166">For another version, 5.1.0.0, you create a secret for `5100-AppSecret`.</span></span> <span data-ttu-id="34e49-167">각 응용 프로그램 버전으로 해당 구성에는 자체 비밀 값 로드 `AppSecret`, 비밀 로드 된 버전에서 제거 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-167">Each app version loads its own secret value into its configuration as `AppSecret`, stripping off the version as it loads the secret.</span></span> <span data-ttu-id="34e49-168">샘플의 구현은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-168">The sample's implementation is shown below:</span></span>

[!code-csharp[Configuration builder](key-vault-configuration/samples/key-name-prefix-sample/2.x/Program.cs?name=snippet1&highlight=12)]

[!code-csharp[PrefixKeyVaultSecretManager](key-vault-configuration/samples/key-name-prefix-sample/2.x/Startup.cs?name=snippet1)]

<span data-ttu-id="34e49-169">`Load` 을 찾거나 버전 접두사가 있는 자격 증명 모음 암호를 반복 하는 공급자 알고리즘 메서드를 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-169">The `Load` method is called by a provider algorithm that iterates through the vault secrets to find the ones that have the version prefix.</span></span> <span data-ttu-id="34e49-170">버전 접두사와 있을 때 `Load`, 알고리즘이 사용 하는 `GetKey` 메서드를 보안 이름의 구성 이름을 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-170">When a version prefix is found with `Load`, the algorithm uses the `GetKey` method to return the configuration name of the secret name.</span></span> <span data-ttu-id="34e49-171">암호의 이름에서 버전 접두사를 제거 하 고 이름-값 쌍에 응용 프로그램의 구성에 한 로드에 대 한 비밀 이름의 나머지를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-171">It strips off the version prefix from the secret's name and returns the rest of the secret name for loading into the app's configuration name-value pairs.</span></span>

<span data-ttu-id="34e49-172">이 방법은 구현 하는 경우:</span><span class="sxs-lookup"><span data-stu-id="34e49-172">When you implement this approach:</span></span>

1. <span data-ttu-id="34e49-173">주요 자격 증명 모음 암호 로드 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-173">The key vault secrets are loaded.</span></span>
2. <span data-ttu-id="34e49-174">에 대 한 문자열 암호 `5000-AppSecret` 일치 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-174">The string secret for `5000-AppSecret` is matched.</span></span>
3. <span data-ttu-id="34e49-175">버전, `5000` (대시로)는 하이픈이 제거 되어를 종료 하는 키 이름을 오프 `AppSecret` 비밀 값 응용 프로그램의 구성에 로드할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-175">The version, `5000` (with the dash), is stripped off of the key name leaving `AppSecret` to load with the secret value into the app's configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="34e49-176">제공할 수도 있습니다 직접 `KeyVaultClient` 구현 `AddAzureKeyVault`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-176">You can also provide your own `KeyVaultClient` implementation to `AddAzureKeyVault`.</span></span> <span data-ttu-id="34e49-177">사용자 지정 클라이언트를 제공 합니다. 구성 공급자와 응용 프로그램의 다른 파트 간의 클라이언트의 단일 인스턴스를 공유할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-177">Supplying a custom client allows you to share a single instance of the client between the configuration provider and other parts of your app.</span></span>

1. <span data-ttu-id="34e49-178">키 자격 증명 모음 만들기 및 Azure Active Directory (Azure AD)의 지침에 따라 응용 프로그램에 대 한 설정 [Azure 키 자격 증명 모음 시작](https://azure.microsoft.com/documentation/articles/key-vault-get-started/)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-178">Create a key vault and set up Azure Active Directory (Azure AD) for the application following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
  * <span data-ttu-id="34e49-179">암호를 사용 하 여 주요 자격 증명 모음에 추가 된 [AzureRM 키 자격 증명 모음 PowerShell 모듈](/powershell/module/azurerm.keyvault) 에서 사용할 수는 [PowerShell 갤러리](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure 키 자격 증명 모음 REST API](/rest/api/keyvault/), 또는 [Azure 포털](https://portal.azure.com/)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-179">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="34e49-180">비밀 하나로 만들어집니다 *수동* 또는 *인증서* 비밀 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-180">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="34e49-181">*인증서* 비밀 앱 및 서비스에서 사용 하기 위해 인증서가 있지만 구성 공급자에서 지원 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-181">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="34e49-182">사용 해야는 *수동* 구성 공급자와 함께 사용 하기 위해 암호 이름-값 쌍을 만드는 옵션을 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-182">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
    * <span data-ttu-id="34e49-183">계층 값 (구성 섹션) 사용 하 여 `--` (대시 두 개)를 구분 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-183">Hierarchical values (configuration sections) use `--` (two dashes) as a separator.</span></span>
    * <span data-ttu-id="34e49-184">두 개 만든 *수동* 다음 이름-값 쌍이 있는 비밀 정보:</span><span class="sxs-lookup"><span data-stu-id="34e49-184">Create two *Manual* secrets with the following name-value pairs:</span></span>
      * <span data-ttu-id="34e49-185">`5000-AppSecret`: `5.0.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="34e49-185">`5000-AppSecret`: `5.0.0.0_secret_value`</span></span>
      * <span data-ttu-id="34e49-186">`5100-AppSecret`: `5.1.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="34e49-186">`5100-AppSecret`: `5.1.0.0_secret_value`</span></span>
  * <span data-ttu-id="34e49-187">Azure Active Directory와 샘플 응용 프로그램을 등록 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-187">Register the sample app with Azure Active Directory.</span></span>
  * <span data-ttu-id="34e49-188">응용 프로그램에서 주요 자격 증명 모음에 액세스 권한을 부여 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-188">Authorize the app to access the key vault.</span></span> <span data-ttu-id="34e49-189">사용 하는 경우는 `Set-AzureRmKeyVaultAccessPolicy` 앱 키 자격 증명 모음에 액세스할 수 권한을 부여 하는 PowerShell cmdlet을 제공 `List` 및 `Get` 와 비밀 정보에 대 한 액세스 `-PermissionsToKeys list,get`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-189">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToKeys list,get`.</span></span>
2. <span data-ttu-id="34e49-190">응용 프로그램의 업데이트 *appsettings.json* 파일의 값을 가진 `Vault`, `ClientId`, 및 `ClientSecret`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-190">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="34e49-191">구성 값을 가져오는 샘플 응용 프로그램을 실행 `IConfigurationRoot` 접두사가 붙은 비밀 이름으로 같은 이름의 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-191">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the prefixed secret name.</span></span> <span data-ttu-id="34e49-192">이 샘플에서는 접두사는 응용 프로그램의 버전에 제공 된 `PrefixKeyVaultSecretManager` Azure 키 자격 증명 모음 구성 공급자를 추가 하는 경우.</span><span class="sxs-lookup"><span data-stu-id="34e49-192">In this sample, the prefix is the app's version, which you provided to the `PrefixKeyVaultSecretManager` when you added the Azure Key Vault configuration provider.</span></span> <span data-ttu-id="34e49-193">에 대 한 값 `AppSecret` 사용 하 여 얻은 `config["AppSecret"]`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-193">The value for `AppSecret` is obtained with `config["AppSecret"]`.</span></span> <span data-ttu-id="34e49-194">응용 프로그램에 의해 생성 된 웹 페이지 로드 된 값을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-194">The webpage generated by the app shows the loaded value:</span></span>

   ![응용 프로그램의 버전을 5.0.0.0 Azure 키 자격 증명 모음 구성 공급자를 통해 로드 되는 브라우저 창에 비밀 값 표시](key-vault-configuration/_static/sample2-1.png)

4. <span data-ttu-id="34e49-196">프로젝트 파일에서 응용 프로그램 어셈블리의 버전을 변경 `5.0.0.0` 를 `5.1.0.0` 응용 프로그램을 다시 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-196">Change the version of the app assembly in the project file from `5.0.0.0` to `5.1.0.0` and run the app again.</span></span> <span data-ttu-id="34e49-197">이 이번에 반환 된 보안 값은 `5.1.0.0_secret_value`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-197">This time, the secret value returned is `5.1.0.0_secret_value`.</span></span> <span data-ttu-id="34e49-198">응용 프로그램에 의해 생성 된 웹 페이지 로드 된 값을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-198">The webpage generated by the app shows the loaded value:</span></span>

   ![응용 프로그램의 버전을 5.1.0.0 Azure 키 자격 증명 모음 구성 공급자를 통해 로드 되는 브라우저 창에 비밀 값 표시](key-vault-configuration/_static/sample2-2.png)

## <a name="controlling-access-to-the-clientsecret"></a><span data-ttu-id="34e49-200">ClientSecret에 대 한 액세스를 제어합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-200">Controlling access to the ClientSecret</span></span>
<span data-ttu-id="34e49-201">사용 하 여는 [암호 관리자 도구](xref:security/app-secrets) 유지 관리 하는 `ClientSecret` 프로젝트 소스 트리에 외부입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-201">Use the [Secret Manager tool](xref:security/app-secrets) to maintain the `ClientSecret` outside of your project source tree.</span></span> <span data-ttu-id="34e49-202">암호 관리자와 앱 암호 특정 프로젝트와 연결 여러 프로젝트 간에 공유할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-202">With Secret Manager, you associate app secrets with a specific project and share them across multiple projects.</span></span>

<span data-ttu-id="34e49-203">인증서를 지원 하는 환경에서.NET Framework 앱을 개발 하는 경우 X.509 인증서로 Azure 키 자격 증명 모음에 인증할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-203">When developing a .NET Framework app in an environment that supports certificates, you can authenticate to Azure Key Vault with an X.509 certificate.</span></span> <span data-ttu-id="34e49-204">X.509 인증서의 개인 키는 운영 체제에서 관리 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-204">The X.509 certificate's private key is managed by the OS.</span></span> <span data-ttu-id="34e49-205">자세한 내용은 참조 [클라이언트 암호 대신 인증서로 인증](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-205">For more information, see [Authenticate with a Certificate instead of a Client Secret](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret).</span></span> <span data-ttu-id="34e49-206">사용 하 여는 `AddAzureKeyVault` 를 받아들이는 오버 로드는 `X509Certificate2`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-206">Use the `AddAzureKeyVault` overload that accepts an `X509Certificate2`.</span></span>

```csharp
var store = new X509Store(StoreLocation.CurrentUser);
store.Open(OpenFlags.ReadOnly);
var cert = store.Certificates.Find(X509FindType.FindByThumbprint, config["CertificateThumbprint"], false);

builder.AddAzureKeyVault(
    config["Vault"],
    config["ClientId"],
    cert.OfType<X509Certificate2>().Single(),
    new EnvironmentSecretManager(env.ApplicationName));
store.Close();

Configuration = builder.Build();
```

## <a name="reloading-secrets"></a><span data-ttu-id="34e49-207">암호를 다시 로드</span><span class="sxs-lookup"><span data-stu-id="34e49-207">Reloading secrets</span></span>
<span data-ttu-id="34e49-208">될 때까지 캐시 된 비밀 `IConfigurationRoot.Reload()` 호출 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-208">Secrets are cached until `IConfigurationRoot.Reload()` is called.</span></span> <span data-ttu-id="34e49-209">만료를 사용할 수 없을 때까지 응용 프로그램 키 자격 증명 모음에 업데이트 된 비밀 정보를 준수 하지 않 및 `Reload` 실행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-209">Expired, disabled, and updated secrets in the key vault are not respected by the application until `Reload` is executed.</span></span>

```csharp
Configuration.Reload();
```

## <a name="disabled-and-expired-secrets"></a><span data-ttu-id="34e49-210">사용 안 함 및 만료 된 암호</span><span class="sxs-lookup"><span data-stu-id="34e49-210">Disabled and expired secrets</span></span>
<span data-ttu-id="34e49-211">사용 안 함 및 만료 된 암호를 throw 한 `KeyVaultClientException`합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-211">Disabled and expired secrets throw a `KeyVaultClientException`.</span></span> <span data-ttu-id="34e49-212">응용 프로그램에서 throw를 방지 하려면 응용 프로그램을 교체 또는 사용 안 함/만료 된 암호를 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-212">To prevent your app from throwing, replace your app or update the disabled/expired secret.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="34e49-213">문제 해결</span><span class="sxs-lookup"><span data-stu-id="34e49-213">Troubleshooting</span></span>
<span data-ttu-id="34e49-214">응용 프로그램에서 공급자를 사용 하 여 구성을 로드 하지 못하는에 오류 메시지가 기록 됩니다는 [ASP.NET 로깅 인프라](xref:fundamentals/logging)합니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-214">When the application fails to load configuration using the provider, an error message is written to the [ASP.NET Logging infrastructure](xref:fundamentals/logging).</span></span> <span data-ttu-id="34e49-215">다음과 같은 구성을 로드에서 하지 것입니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-215">The following conditions will prevent configuration from loading:</span></span>
* <span data-ttu-id="34e49-216">응용 프로그램은 Azure Active Directory에 올바르게 구성 되지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-216">The app isn't configured correctly in Azure Active Directory.</span></span>
* <span data-ttu-id="34e49-217">Azure 키 자격 증명 모음에 키 자격 증명 모음 존재 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-217">The key vault doesn't exist in Azure Key Vault.</span></span>
* <span data-ttu-id="34e49-218">응용 프로그램에 키 자격 증명 모음에 액세스할 권한이 부여 되지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-218">The app isn't authorized to access the key vault.</span></span>
* <span data-ttu-id="34e49-219">액세스 정책에 포함 되지 않으면 `Get` 및 `List` 사용 권한.</span><span class="sxs-lookup"><span data-stu-id="34e49-219">The access policy doesn't include `Get` and `List` permissions.</span></span>
* <span data-ttu-id="34e49-220">키 자격 증명 모음에 구성 데이터 (이름-값 쌍)는 이름이 잘못 지정, 누락 된 경우 비활성화 되었거나 만료 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-220">In the key vault, the configuration data (name-value pair) is incorrectly named, missing, disabled, or expired.</span></span>
* <span data-ttu-id="34e49-221">응용 프로그램에 잘못 된 키 자격 증명 모음 이름 (`Vault`), Azure AD 응용 프로그램 Id (`ClientId`), 또는 Azure AD 키 (`ClientSecret`).</span><span class="sxs-lookup"><span data-stu-id="34e49-221">The app has the wrong key vault name (`Vault`), Azure AD App Id (`ClientId`), or Azure AD Key (`ClientSecret`).</span></span>
* <span data-ttu-id="34e49-222">Azure AD 키 (`ClientSecret`) 만료 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-222">The Azure AD Key (`ClientSecret`) is expired.</span></span>
* <span data-ttu-id="34e49-223">구성 키 (이름)을 로드 하려고 하는 값에 대 한 응용 프로그램에서 올바르지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="34e49-223">The configuration key (name) is incorrect in the app for the value you're trying to load.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="34e49-224">추가 리소스</span><span class="sxs-lookup"><span data-stu-id="34e49-224">Additional resources</span></span>
* <xref:fundamentals/configuration>
* [<span data-ttu-id="34e49-225">Microsoft Azure: 키 자격 증명 모음</span><span class="sxs-lookup"><span data-stu-id="34e49-225">Microsoft Azure: Key Vault</span></span>](https://azure.microsoft.com/services/key-vault/)
* [<span data-ttu-id="34e49-226">Microsoft Azure: 키 자격 증명 모음 설명서</span><span class="sxs-lookup"><span data-stu-id="34e49-226">Microsoft Azure: Key Vault Documentation</span></span>](https://docs.microsoft.com/azure/key-vault/)
* [<span data-ttu-id="34e49-227">Azure 키 자격 증명 모음에 대 한 키 생성 및 HSM 보호 된 전송 하는 방법</span><span class="sxs-lookup"><span data-stu-id="34e49-227">How to generate and transfer HSM-protected keys for Azure Key Vault</span></span>](https://docs.microsoft.com/azure/key-vault/key-vault-hsm-protected-keys)
* [<span data-ttu-id="34e49-228">KeyVaultClient 클래스</span><span class="sxs-lookup"><span data-stu-id="34e49-228">KeyVaultClient Class</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.keyvault.keyvaultclient)
