---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: 계정 확인 및 ASP.NET Identity (C#) 사용 하 여 암호 복구 | Microsoft Docs
author: HaoK
description: 먼저 완료 해야이 자습서를 수행 하기 전에 전자 메일 확인 및 암호 재설정에 대 한 로그와 함께 보안 ASP.NET MVC 5 웹 응용 프로그램을 만듭니다. 이 자습서 중...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/26/2015
ms.topic: article
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 0167388cf6b488b72ca36f583a7794690dbf9900
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/06/2018
---
<a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="594a3-104">계정 확인 및 암호 복구 ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="594a3-104">Account Confirmation and Password Recovery with ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="594a3-105">여 [Hao 둘러싼](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="594a3-105">by [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="594a3-106">이 자습서를 수행 하기 전에 먼저를 완료 해야 [전자 메일 확인 및 암호 재설정에 대 한 로그와 보안 ASP.NET MVC 5 웹 응용 프로그램을 만들](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-106">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="594a3-107">이 자습서 자세한 세부 정보를 포함 하 고 로컬 계정 확인에 대 한 전자 메일을 설정 하 고 사용자가 ASP.NET Identity에서 잊은 암호를 재설정 하도록 허용 하는 방법을 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-107">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span> <span data-ttu-id="594a3-108">이 문서 Rick Anderson에 의해 작성 되었으므로 ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao 둘러싼 및 Suhas Joshi 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-108">This article was written by Rick Anderson ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung, and Suhas Joshi.</span></span> <span data-ttu-id="594a3-109">NuGet 샘플 Hao 둘러싼 주로 썼습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-109">The NuGet sample was written primarily by Hao Kung.</span></span>


<span data-ttu-id="594a3-110">로컬 사용자 계정을 사용자 계정에 대 한 암호를 만들기 위해 필요 하 고 해당 암호 web app에서 (안전 하 게) 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-110">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="594a3-111">ASP.NET Id는 소셜 계정, 사용자를 응용 프로그램에 대 한 암호를 만들 필요 하지도 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-111">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="594a3-112">[소셜 계정](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) 는 제 3 자 (예: Google, Twitter, Facebook 또는 Microsoft)를 사용 하 여 사용자를 인증 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-112">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook or Microsoft) to authenticate users.</span></span> <span data-ttu-id="594a3-113">이 항목에서는 다음에 대해 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-113">This topic covers the following:</span></span>

- <span data-ttu-id="594a3-114">[ASP.NET MVC 응용 프로그램을 만들](#createMvc) ASP.NET Id 기능을 탐색 하 고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-114">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="594a3-115">Identity 샘플 빌드</span><span class="sxs-lookup"><span data-stu-id="594a3-115">Building the Identity sample</span></span>](#build)
- [<span data-ttu-id="594a3-116">전자 메일 확인 설정</span><span class="sxs-lookup"><span data-stu-id="594a3-116">Set up email confirmation</span></span>](#email)

<span data-ttu-id="594a3-117">새 사용자가 자신의 전자 메일 별칭을 로컬 계정을 만들고 등록 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-117">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="594a3-118">레지스터 단추를 클릭 하는 전자 메일 주소가 유효성 검사 토큰을 포함 하는 확인 전자 메일을 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-118">Clicking the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="594a3-119">사용자는 자신의 계정에 대 한 확인 토큰 포함 된 메일이 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-119">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="594a3-120">링크를 클릭 하는 계정을 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-120">Clicking the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="594a3-121">암호 복구/다시 설정</span><span class="sxs-lookup"><span data-stu-id="594a3-121">Password recovery/reset</span></span>

<span data-ttu-id="594a3-122">자신의 암호를 잊은 로컬 사용자 자신의 암호를 재설정할 수 있도록 전자 메일 계정으로 전송 하는 보안 토큰을 가질 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-122">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="594a3-123">곧 사용자 암호를 재설정 하도록 허용 하는 링크와 전자 메일을 받게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-123">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="594a3-124">링크를 클릭 하면 재설정 페이지로 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-124">Clicking the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="594a3-125">클릭 하 고 **다시 설정** 암호를 다시 설정 단추는 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-125">Clicking the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="594a3-126">ASP.NET 웹 앱 만들기</span><span class="sxs-lookup"><span data-stu-id="594a3-126">Create an ASP.NET Web app</span></span>

<span data-ttu-id="594a3-127">설치 하 고 실행 하 여 시작 [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) 또는 [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-127">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="594a3-128">Visual Studio 설치 [2013 업데이트 2](https://go.microsoft.com/fwlink/?LinkId=390521) 이상.</span><span class="sxs-lookup"><span data-stu-id="594a3-128">Install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="594a3-129">경고: Visual Studio를 설치 해야 [2013 업데이트 2](https://go.microsoft.com/fwlink/?LinkId=390521) 이 자습서를 완료 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-129">Warning: You must install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) to complete this tutorial.</span></span>


1. <span data-ttu-id="594a3-130">새 ASP.NET 웹 프로젝트를 만들고 MVC 템플릿을 선택 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-130">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="594a3-131">Web Forms web forms 응용 프로그램에서 비슷한 단계를 반영할 수 있도록 ASP.NET Id를도 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-131">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="594a3-132">기본 인증을 두고 **개별 사용자 계정**합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-132">Leave the default authentication as **Individual User Accounts**.</span></span>
3. <span data-ttu-id="594a3-133">응용 프로그램 실행을 클릭는 **등록** 에 연결 하 고 사용자를 등록 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-133">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="594a3-134">전자 메일에만 유효성 검사와는 시점에서 [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) 특성입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-134">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="594a3-135">서버 탐색기에서로 이동 **데이터 Connections\DefaultConnection\Tables\AspNetUsers**를 마우스 오른쪽 단추로 클릭 하 고 **테이블 정의 열고**합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-135">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="594a3-136">다음 그림에서는 `AspNetUsers` 스키마:</span><span class="sxs-lookup"><span data-stu-id="594a3-136">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="594a3-137">마우스 오른쪽 단추로 클릭는 **AspNetUsers** 테이블을 선택한 **테이블 데이터 표시**합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-137">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="594a3-138">이 시점에서 전자 메일 확인 되지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-138">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="594a3-139">ASP.NET Id에 대 한 기본 데이터 저장소는 Entity Framework 하지만 다른 데이터 저장소를 사용 하 고 필드를 더 추가 하 고 구성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-139">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="594a3-140">참조 [추가 리소스](#addRes) 이 자습서의 마지막 부분에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-140">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="594a3-141">[OWIN 시작 클래스](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) 응용 프로그램 시작 및 호출 될 때 호출 되는 `ConfigureAuth` 에서 메서드 *앱\_Start\Startup.Auth.cs*, OWIN 파이프라인을 구성 하 고 ASP.NET Identity를 초기화 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-141">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="594a3-142">검사는 `ConfigureAuth` 메서드.</span><span class="sxs-lookup"><span data-stu-id="594a3-142">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="594a3-143">각 `CreatePerOwinContext` 호출 콜백을 등록 (에 저장 된 `OwinContext`) 지정 된 형식의 인스턴스를 만드는 요청당 한 번 호출 될 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-143">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="594a3-144">생성자에 중단점을 설정할 수 있습니다 및 `Create` 각 유형의 메서드 (`ApplicationDbContext, ApplicationUserManager`)은 각 요청에서 호출을 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-144">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="594a3-145">인스턴스 `ApplicationDbContext` 및 `ApplicationUserManager` 응용 프로그램을 통해 액세스할 수 있는 OWIN 컨텍스트로 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-145">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="594a3-146">쿠키 미들웨어를 통해 OWIN 파이프라인에 연결 하는 ASP.NET Identity입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-146">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="594a3-147">자세한 내용은 참조 [ASP.NET Identity에서 UserManager 클래스에 대 한 요청 수명 관리 당](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-147">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="594a3-148">새 보안 스탬프를 생성 되 고에 저장 된 보안 프로필을 변경 하면는 `SecurityStamp` 필드는 *AspNetUsers* 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-148">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="594a3-149">단는 `SecurityStamp` 필드는 보안 쿠키와에서 다릅니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-149">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="594a3-150">보안 쿠키에 저장 되지 않습니다는 `AspNetUsers` 테이블 (또는 Identity DB의 다른 곳).</span><span class="sxs-lookup"><span data-stu-id="594a3-150">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="594a3-151">사용 하 여 보안 쿠키 토큰 자체 서명 [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) 와 만들어집니다는 `UserId, SecurityStamp` 및 만료 시간 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-151">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="594a3-152">쿠키 미들웨어 각 요청에 대해 쿠키를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-152">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="594a3-153">`SecurityStampValidator` 에서 메서드는 `Startup` 클래스 DB에 도달 하 고 보안 스탬프를 주기적으로 확인 된 지정 된 대로 `validateInterval`합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-153">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="594a3-154">이 보안 프로필을 변경 하지 않는 한 (샘플)에서 30 분 마다만 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-154">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="594a3-155">30 분 간격 데이터베이스에 대 한 왕복을 최소화 하기 위해 선택 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-155">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="594a3-156">참조 내 [자습서 2 단계 인증](index.md) 내용을 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-156">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="594a3-157">코드의 주석을 당는 `UseCookieAuthentication` 메서드 쿠키 인증을 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-157">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="594a3-158">`SecurityStamp` 추가 계층을 제공 하는 필드와 연결 된 코드는 응용 프로그램에 보안을 암호를 변경 하면 경고가 기록 됩니다 로그인 사용한 브라우저 외부에서.</span><span class="sxs-lookup"><span data-stu-id="594a3-158">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="594a3-159">`SecurityStampValidator.OnValidateIdentity` 메서드를 사용 하면 암호를 변경 하거나 외부 로그인을 사용할 때 사용 되는 응용 프로그램을 사용자가 로그인 할 때 보안 토큰의 유효성을 검사 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-159">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="594a3-160">이 이전 암호를 사용 하 여 생성 중인 토큰 (쿠키)이 무효화 됩니다 되도록 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-160">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="594a3-161">샘플 프로젝트에 변경 하는 경우 사용자의 암호가 다음 새 토큰을 사용자에 대해 생성 되, 이전 모든 토큰이 무효화 되 고 `SecurityStamp` 필드가 업데이트 되 고 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-161">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="594a3-162">Id 시스템 구성할 수 있도록 앱 하므로 사용자가 보안 프로필 변경 될 때 (사용자의 암호 또는 변경 내용이 변경 될 때 로그인을 연결 하는 예를 들어 (예: Facebook, Google, Microsoft 계정 등)에서 모든 사용자가 로그인 브라우저 인스턴스입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-162">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="594a3-163">예를 들어 다음 이미지는 [Single sign-out 샘플](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) 응용 프로그램에 사용 하면 한 개의 단추를 클릭 하 여 로그 아웃에 (이 경우 IE, Firefox 및 Chrome)에 있는 모든 브라우저 인스턴스를 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-163">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by clicking one button.</span></span> <span data-ttu-id="594a3-164">또는 샘플만에서 로그 아웃 특정 브라우저 인스턴스를 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-164">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="594a3-165">[Single sign-out 샘플](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) 앱은 ASP.NET Identity 허용 하는 보안 토큰을 다시 생성 하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-165">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="594a3-166">이 이전 암호를 사용 하 여 생성 중인 토큰 (쿠키)이 무효화 됩니다 되도록 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-166">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="594a3-167">이 기능은 보안; 응용 프로그램에 추가적인을 제공합니다. 암호를 변경 하면이 응용 프로그램에 로그인 한 위치 아웃 기록 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-167">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="594a3-168">*앱\_Start\IdentityConfig.cs* 파일에 포함 되어는 `ApplicationUserManager`, `EmailService` 및 `SmsService` 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-168">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="594a3-169">`EmailService` 및 `SmsService` 각 구현 클래스는 `IIdentityMessageService` 인터페이스, 전자 메일 및 SMS를 구성 하려면 각 클래스에 공용 메서드를 갖도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-169">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="594a3-170">이 자습서에서는 통해 전자 메일 알림을 추가 하는 방법을 보여 줍니다. 하지만 [SendGrid](http://sendgrid.com/), SMTP 및 다른 메커니즘을 사용 하 여 메일을 보낼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-170">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="594a3-171">`Startup` 클래스 (Facebook, Twitter, 등)에 소셜 로그인 내 자습서를 참조 하십시오. 추가할 보일 러 플레이트 포함 되어 [Facebook, Twitter, LinkedIn 및 Google OAuth2 로그온 된 MVC 5 앱](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) 대 한 자세한 정보.</span><span class="sxs-lookup"><span data-stu-id="594a3-171">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="594a3-172">검사는 `ApplicationUserManager` 사용자 id 정보를 포함 하 고 다음과 같은 기능을 구성 하는 클래스:</span><span class="sxs-lookup"><span data-stu-id="594a3-172">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="594a3-173">암호 강도 요구 사항입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-173">Password strength requirements.</span></span>
- <span data-ttu-id="594a3-174">사용자 잠금 (시도 및 시간)입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-174">User lock out (attempts and time).</span></span>
- <span data-ttu-id="594a3-175">2 단계 인증 (2FA)입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-175">Two-factor authentication (2FA).</span></span> <span data-ttu-id="594a3-176">사항이 2FA 및 SMS 다른 자습서입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-176">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="594a3-177">전자 메일 및 SMS 서비스를 연결 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-177">Hooking up the email and SMS services.</span></span> <span data-ttu-id="594a3-178">(하겠습니다 SMS 다른 자습서에).</span><span class="sxs-lookup"><span data-stu-id="594a3-178">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="594a3-179">`ApplicationUserManager` 제네릭에서 클래스 파생 `UserManager<ApplicationUser>` 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-179">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="594a3-180">`ApplicationUser` 파생 [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-180">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="594a3-181">`IdentityUser` 원본에서 파생 `IdentityUser` 클래스:</span><span class="sxs-lookup"><span data-stu-id="594a3-181">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="594a3-182">위의 속성의 속성에 맞춰는 `AspNetUsers` 위에 표시 된 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-182">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="594a3-183">제네릭 인수에서 `IUser` 다양 한 종류를 사용 하 여 기본 키에 대 한 클래스를 파생 시킬 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-183">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="594a3-184">참조는 [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) int 또는 GUID 문자열에서 기본 키를 변경 하는 방법을 보여 주는 샘플입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-184">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="594a3-185">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="594a3-185">ApplicationUser</span></span>

<span data-ttu-id="594a3-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`)에 정의 된 *Models\IdentityModels.cs* 로:</span><span class="sxs-lookup"><span data-stu-id="594a3-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="594a3-187">위의 강조 표시 된 코드를 생성 한 [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-187">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="594a3-188">ASP.NET Identity OWIN 쿠키 인증 되며 클레임 기반, 프레임 워크 하므로 응용 프로그램에서 생성 한 `ClaimsIdentity` 사용자에 대 한 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-188">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="594a3-189">`ClaimsIdentity` 정보가 사용자의 이름과 같은 사용자에 대 한 모든 클레임에 대 한 기간 및 해당 사용자가 역할에 속해 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-189">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="594a3-190">또한이 단계에서 사용자에 대 한 더 많은 클레임을 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-190">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="594a3-191">OWIN `AuthenticationManager.SignIn` 메서드에 전달 된 `ClaimsIdentity` 사용자가 로그인:</span><span class="sxs-lookup"><span data-stu-id="594a3-191">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="594a3-192">[Facebook, Twitter, LinkedIn 및 Google OAuth2 로그온 된 MVC 5 앱](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) 추가 속성을 추가 하는 방법을 보여 줍니다.는 `ApplicationUser` 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-192">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="594a3-193">전자 메일 확인</span><span class="sxs-lookup"><span data-stu-id="594a3-193">Email confirmation</span></span>

<span data-ttu-id="594a3-194">다른 사용자에 가장 하지 않는 것을 확인 하려면 새 사용자 등록 전자 메일을 확인 하는 것이 좋습니다 (즉, 이러한 하지 않은 등록 된 다른 사용자의 전자 메일).</span><span class="sxs-lookup"><span data-stu-id="594a3-194">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="594a3-195">방지 하기 위해 원할 토론 포럼을 설치한 경우를 가정해 볼 `"bob@example.com"` 등록에서 `"joe@contoso.com"`합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-195">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="594a3-196">전자 메일 확인 하지 않고 `"joe@contoso.com"` 원치 않는 전자 메일 앱에서 가져올 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-196">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="594a3-197">실수로 Bob로 등록 된 경우를 가정해 볼 `"bib@example.com"` 를 발견 하지 않은 그 하는지 앱에 없는 올바른 전자 메일 때문에 암호 복구를 사용할 수 없게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-197">Suppose Bob accidently registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="594a3-198">전자 메일 확인 bot에서 제한 된 보호만을 제공 하 고 결정된 된 스팸에서 보호를 제공 하지 않습니다, 그리고 등록 하는 데 사용할 수는 많은 작업 전자 메일 별칭을가지고 있습니다. 아래 예제에서 사용자 자신의 계정을 확인 될 때까지 암호를 변경할 수 없습니다 (타인이 등록 전자 메일 계정에 수신 확인 링크를 클릭 합니다.) 예를 확인 하 고 자신의 프로필에 변경 하는 경우 사용자는 메일을 보내 관리자가 만든 새 계정에 암호를 다시 설정에 대 한 링크를 보내는 다른 시나리오에이 작업 흐름을 적용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-198">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them clicking on a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="594a3-199">일반적으로 새 사용자 전자 메일, SMS 문자 메시지 또는 기타 메커니즘 확인 하기 전에 모든 데이터 웹 사이트를 게시 하는 것을 방지 하려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-199">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="building-a-more-complete-sample"></a><span data-ttu-id="594a3-200">전체 샘플을 빌드</span><span class="sxs-lookup"><span data-stu-id="594a3-200">Building a more complete sample</span></span>

<span data-ttu-id="594a3-201">이 섹션으로 작업 하는 전체 예제를 다운로드 하려면 NuGet을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-201">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="594a3-202">새 ***빈*** ASP.NET 웹 프로젝트입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-202">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="594a3-203">패키지 관리자 콘솔에서 다음을 입력 하면 다음 명령이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-203">In the Package Manager Console, enter the following the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="594a3-204">이 자습서에서는 [SendGrid](http://sendgrid.com/) 전자 메일을 보내도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-204">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="594a3-205">`Identity.Samples` 패키지와 사용할 코드를 설치 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-205">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="594a3-206">설정의 [SSL을 사용 하도록 프로젝트](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-206">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="594a3-207">로컬 계정 만들기를 클릭 하 여 앱을 실행 하 여 테스트는 **등록** 에 연결 하 고 등록 양식을 게시 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-207">Test local account creation by running the app, clicking on the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="594a3-208">전자 메일 확인을 시뮬레이트하는 데모 전자 메일 링크를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-208">Click the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="594a3-209">이 샘플에서 데모 전자 메일 링크 확인 코드를 제거 (의 `ViewBag.Link` 계정 컨트롤러의 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-209">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="594a3-210">참조는 `DisplayEmail` 및 `ForgotPasswordConfirmation` 작업 메서드 및 razor 뷰가).</span><span class="sxs-lookup"><span data-stu-id="594a3-210">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!NOTE]
> <span data-ttu-id="594a3-211">경고:이 샘플의 보안 설정을 변경 하면 프로덕션 응용 프로그램의 변경 내용을 명시적으로 호출 하는 보안 감사를 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-211">Warning: If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>


## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="594a3-212">응용 프로그램에서 코드를 검사할\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="594a3-212">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="594a3-213">이 샘플에서는 계정을 만들고에 추가 하는 방법을 보여 줍니다.는 *Admin* 역할입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-213">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="594a3-214">관리자 계정에 사용 하려는 전자 메일을 가진 샘플에서 전자 메일을 바꿔야 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-214">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="594a3-215">관리자 계정을 만들어야 하는 지금 바로 가장 쉬운 방법은 프로그래밍 방식으로 `Seed` 메서드.</span><span class="sxs-lookup"><span data-stu-id="594a3-215">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="594a3-216">도구가 나중에 만들고 사용자 및 역할을 관리할 수 있도록 하기 위해 노력 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-216">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="594a3-217">샘플 코드에서는 수를 만들고 사용자 및 역할을 관리 하지만 역할 및 사용자 관리 페이지를 실행 하는 관리자 계정이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-217">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="594a3-218">이 샘플에서는 관리자 계정에는 DB 시드 된 때 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-218">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="594a3-219">암호를 변경 하 고 전자 메일 알림을 받을 수 있는 계정 이름을 변경 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-219">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="594a3-220">보안-소스 코드에서 중요 한 데이터 저장 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-220">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="594a3-221">앞에서 설명한 대로 `app.CreatePerOwinContext` 시작 클래스에서 호출에 대 한 콜백을 추가 하는 `Create` DB 응용 프로그램 콘텐츠, 사용자 관리자 및 역할 관리자 클래스의 메서드.</span><span class="sxs-lookup"><span data-stu-id="594a3-221">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="594a3-222">OWIN 파이프라인 호출은 `Create` 이러한 이벤트에 대해 각 요청에 대 한 클래스 메서드와 각 클래스에 대 한 컨텍스트를 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-222">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="594a3-223">계정 컨트롤러 사용자 관리자는 HTTP 컨텍스트 (에서 OWIN 컨텍스트를 포함)를 노출 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-223">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="594a3-224">로컬 계정, 사용자가 등록할 때는 `HTTP Post Register` 메서드를 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-224">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="594a3-225">위의 코드 모델 데이터를 사용 하 여 전자 메일 및 입력 한 암호를 사용 하 여 새 사용자 계정을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-225">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="594a3-226">전자 메일 별칭 데이터 저장소에 있으면 계정 만들기가 실패 하 고 양식을 다시 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-226">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="594a3-227">`GenerateEmailConfirmationTokenAsync` 메서드 보안 확인 토큰을 만드는 데 ASP.NET Identity 데이터 저장소에 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-227">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="594a3-228">[Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) 메서드를 포함 하는 링크 만듭니다는 `UserId` 및 확인 토큰입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-228">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="594a3-229">이 링크는 사용자에 게 메일로 다음, 해당 계정을 확인 하는 전자 메일 앱의 링크에서 클릭할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-229">This link is then emailed to the user, the user can click on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="594a3-230">전자 메일 확인 설정</span><span class="sxs-lookup"><span data-stu-id="594a3-230">Set up email confirmation</span></span>

<span data-ttu-id="594a3-231">이동 하는 [Azure SendGrid 등록 페이지](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) 무료 계정을 등록 하 고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-231">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="594a3-232">SendGrid를 구성 하려면 다음과 유사한 코드를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-232">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="594a3-233">전자 메일 클라이언트에는 자주 텍스트 메시지 (HTML)만 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-233">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="594a3-234">메시지 텍스트와 HTML에 제공 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-234">You should provide the message in text and HTML.</span></span> <span data-ttu-id="594a3-235">위의 SendGrid 예제에서 이러한 용도로 `myMessage.Text` 및 `myMessage.Html` 위에 표시 된 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-235">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>


<span data-ttu-id="594a3-236">다음 코드를 사용 하 여 전자 메일을 전송 하는 방법을 보여 줍니다는 [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) 클래스 `message.Body` 링크만 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-236">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="594a3-237">보안-소스 코드에서 중요 한 데이터 저장 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-237">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="594a3-238">계정 및 자격 증명 appSetting에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-238">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="594a3-239">Azure에서 안전 하 게에 저장할 수 있습니다 이러한 값은 **[구성](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** Azure 포털에서 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-239">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="594a3-240">참조 [ASP.NET 및 Azure에 암호 및 기타 중요 한 데이터 배포에 대 한 유용한](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-240">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


<span data-ttu-id="594a3-241">SendGrid 자격 증명을 입력 앱을 실행 된 전자 메일 별칭 레지스터 수 링크를 클릭 하십시오 확인 전자 메일에 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-241">Enter your SendGrid credentials, run the app, register with an email alias can click the confirm link in your email.</span></span> <span data-ttu-id="594a3-242">이 작업을 수행 하는 방법을 보려면 프로그램 [Outlook.com](http://outlook.com) 전자 메일 계정, John Atten 참조 [Outlook.Com SMTP 호스트에 대 한 C# SMTP 구성](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) 및 이들의[ASP.NET Identity 2.0: 계정 구성 설정 유효성 검사 2 단계 인증 및](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) 게시 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-242">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="594a3-243">사용자가 클릭 한 후의 **등록** 단추 확인 전자 메일 유효성 검사 토큰이 포함 된 해당 전자 메일 주소로 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-243">Once a user clicks the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="594a3-244">사용자는 자신의 계정에 대 한 확인 토큰 포함 된 메일이 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-244">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="594a3-245">코드 검사</span><span class="sxs-lookup"><span data-stu-id="594a3-245">Examine the code</span></span>

<span data-ttu-id="594a3-246">다음 코드는 `POST ForgotPassword` 메서드를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-246">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="594a3-247">사용자 전자 메일 확인 되지 않았습니다 메서드가 자동으로 실패 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-247">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="594a3-248">오류가 잘못 된 전자 메일 주소에 대 한 게시 된 경우 악의적인 사용자가 해당 정보 공격에 올바른 사용자 Id (전자 메일 별칭)을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-248">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="594a3-249">다음 코드는 `ConfirmEmail` 계정 컨트롤러을 보낼 전자 메일 확인 링크를 클릭할 때 호출 되는 메서드:</span><span class="sxs-lookup"><span data-stu-id="594a3-249">The following code shows the `ConfirmEmail` method in the account controller that is called when the user clicks the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="594a3-250">잊어버린된 암호 토큰을 사용한 후에, 무효화 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-250">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="594a3-251">다음 코드 변경 내용을 `Create` 메서드 (에 *앱\_Start\IdentityConfig.cs* 파일) 토큰 3 시간에 만료 되도록 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-251">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="594a3-252">위의 코드와 함께 잊어버린된 암호 및 전자 메일 확인 토큰 3 시간에 만료 됩니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-252">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="594a3-253">기본 `TokenLifespan` 은 1 일입니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-253">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="594a3-254">다음 코드에는 전자 메일 확인 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-254">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="594a3-255">응용 프로그램을 보다 안전 하 게 ASP.NET Identity (2FA) 2 단계 인증을 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-255">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="594a3-256">참조 [ASP.NET Identity 2.0: 계정 유효성 검사 및 2 단계 인증을 설정](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) John Atten 여 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-256">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="594a3-257">로그인 암호 시도 실패에 계정 잠금에 설정할 수 있지만 해당 접근 방식을 통해 사용자의 로그인에 취약 [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) 잠금을 수행 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-257">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="594a3-258">계정 잠금 2FA에만 사용 하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-258">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="594a3-259">추가 자료</span><span class="sxs-lookup"><span data-stu-id="594a3-259">Additional Resources</span></span>

- [<span data-ttu-id="594a3-260">ASP.NET ID에 대한 사용자 지정 저장소 공급자 개요</span><span class="sxs-lookup"><span data-stu-id="594a3-260">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="594a3-261">[Facebook, Twitter, LinkedIn 및 Google OAuth2 로그온 된 MVC 5 앱](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) 사용자 테이블에 프로필 정보를 추가 하는 방법도 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-261">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="594a3-262">[ASP.NET MVC 및 Id 2.0: 기본 사항을 이해](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) John Atten 여 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-262">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="594a3-263">ASP.NET ID 소개</span><span class="sxs-lookup"><span data-stu-id="594a3-263">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="594a3-264">[ASP.NET Identity 2.0.0의 RTM 발표](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) Pranav Rastogi 여 합니다.</span><span class="sxs-lookup"><span data-stu-id="594a3-264">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
